$(function(){function e(e){$("#country").find("button[value="+e.toLowerCase()+"]").trigger("click")}const a=$("#email"),o=$("#password");let n="",t="",c="",r=0,u=0,s="+82",l="KR",d="";API.getCurrentCountryInfo(d,a=>{a.payload.calling_code&&(s=a.payload.calling_code),a.payload.country_code&&(l=a.payload.country_code),e(l),a.payload.ip&&(d=a.payload.ip),$("#phoneCountry").val(s)}),API.getCountry(a=>{let o="";a.payload.map(e=>{o||(o=e.code.toLowerCase()),$("#country").dropdown("add",{value:e.code.toLowerCase(),text:`<i class="flag ${e.code.toLowerCase()}"></i> ${e.name}`})}),$("#country").dropdown("select",o).dropdown("add_search"),e(l)}),$("#create-account-country").on("submit",e=>(e.preventDefault(),window.sessionStorage.country=$("#country").dropdown("selected"),$("#create-account-country").parent("section").hide(),$("#create-account-info").parent("section").show(),!1)),$("#email").on("change",function(){const e=$(this).val();API.checkJoin("userid",e,function(a){if(a&&a.success)for(row of($("#checkJoin").val("N"),a.payload))row.id==e&&"joined"==row.status&&$("#checkJoin").val("Y")})}),$("#create-account-info").on("submit",e=>(e.preventDefault(),a.val()?!1===/^\w+([\.-]?\w+)*@\w+([\.-]?\w+)*(\.\w{2,3})+$/.test(a.val())?(a.focus(),alert(__("올바른 E-mail 주소를 입력해주세요")),!1):"Y"==$("#checkJoin").val()?(alert(__("이미 가입되어있는 이메일입니다.")+" \n"+__("다른 이메일을 입력해주세요.")),!1):o.val()?($("#create-account-info").addClass("loading"),$("#create-account-info input[type=submit]").prop("disabled",!0),API.sendEmailConfirmCode(a.val(),e=>{$("#create-account-info").removeClass("loading"),e.success?(n=a.val(),$("#create-account-info").parent("section").hide(),$("#create-account-mail-auth").parent("section").show().find(".grid--code>input:eq(0)").focus()):($("#create-account-info input[type=submit]").prop("disabled",!1),alert(e.error.message))}),!1):(o.focus(),!1):(a.focus(),!1))),$('[name="btn-resend-email"]').on("click",function(){return $("#create-account-mail-auth").addClass("loading"),API.sendEmailConfirmCode(n,e=>{$("#create-account-mail-auth").removeClass("loading"),e.success?$("#create-account-mail-auth").parent("section").show().find(".grid--code>input:eq(0)").focus():alert(e.error.message)}),!1}),$("#create-account-mail-auth").on("submit",e=>{e.preventDefault();let o="";return $("#create-account-mail-auth .grid--code input[type=number]").each((e,a)=>{if(!$(a).val())return check=!1,void $(a).focus();o+=$(a).val()}),$("#create-account-mail-auth").addClass("loading"),$("#create-account-mail-auth input[type=submit]").prop("disabled",!0),API.checkEmailConfirmCode(a.val(),o,e=>{$("#create-account-mail-auth").removeClass("loading"),e.success?(r=1,$("#create-account-mail-auth").parent("section").hide(),$("#create-account-phone").parent("section").show()):(r=0,$("#create-account-mail-auth input[type=submit]").prop("disabled",!1),alert(e.error.message))}),!1}),$("#create-account-phone").on("submit",e=>{e.preventDefault();const a=$("#phoneCountry").val(),o=$("#phone").val();return a?o?($("#create-account-phone").addClass("loading"),$("#create-account-phone input[type=submit]").prop("disabled",!0),API.sendMobileConfirmCode(a,o,e=>{e.success?(t=a,c=o,$("#create-account-phone").parent("section").hide(),$("#create-account-phone-auth").parent("section").show()):($("#create-account-phone input[type=submit]").prop("disabled",!1),alert(e.error.message))}),!1):($("#phone").focus(),!1):($("#phoneCountry").focus(),!1)}),$('[name="btn-resend-sms"]').on("click",function(){if(t&&c)return $("#create-account-phone-auth").addClass("loading"),API.sendMobileConfirmCode(t,c,e=>{$("#create-account-phone-auth").removeClass("loading"),e.success||alert(e.error.message)}),!1}),$("#create-account-phone-auth").on("submit",()=>{let e="",a=!0;return $("#create-account-phone-auth .grid--code input[type=number]").each((o,n)=>{if(!$(n).val())return a=!1,void $(n).focus();e+=$(n).val()}),a&&($("#create-account-phone-auth").addClass("loading"),$("#create-account-phone-auth input[type=submit]").prop("disabled",!0),API.checkMobileConfirmCode(phone,e=>{$("#create-account-phone-auth").removeClass("loading"),e.success?(u=1,$("#create-account-phone-auth").parent("section").hide(),$("#create-account-pin-number").parent("section").show()):(u=0,$("#create-account-phone-auth input[type=submit]").prop("disabled",!1),alert(e.error.message))})),!1}),$("#create-account-pin-number").on("submit",()=>{for(i=0;i<6;i++){const e=$("#create-account-pin-number input[name=pin]:eq("+i+")");if(!$.trim(e.val())){e.focus();break}}return $("#create-account-pin-number").parent("section").hide(),$("#create-account-pin-number-confirm").parent("section").hide(),!1}),$("#create-account-pin-number-confirm").on("submit",()=>{let e="",n="",c=!0;return $("#create-account-pin-number .grid--code input[type=number]").each(a=>{e+=$(a).val()}),$("#create-account-pin-number-confirm .grid--code input[type=number]").each(e=>{if(!$(e).val())return c=!1,void $(e).focus();n+=$(e).val()}),e!==n&&(alert("핀번호가 다릅니다"),c=!1),c&&($("#create-account-pin-number-confirm").addClass("loading"),API.join({social_id:a.val(),social_name:"",email:a.val(),userpw:o.val(),mobile_calling_code:t,mobile_country_code:(window.sessionStorage.country+"").toUpperCase(),pin:e,bool_email:$("#mailing").is(":checked")?1:0,bool_marketing:$("#marketing").is(":checked")?1:0,bool_confirm_email:r,bool_confirm_mobile:u},e=>{$("#create-account-pin-number-confirm").removeClass("loading"),e.success?($("#create-account-pin-number").parent("section").hide(),$("#create-account-pin-number-confirm").parent("section").hide()):alert(e.error.message)})),!1})});