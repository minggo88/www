const Exchange={formatter:{CurrentPrice:(cellValue,_options,rowObject)=>"undefined"!=typeof Intl?rowObject.Difference>=0?'<span class="text-red text-bold">'+new Intl.NumberFormat("ko-KR").format(cellValue)+"</span>":'<span class="text-blue text-bold">'+new Intl.NumberFormat("ko-KR").format(cellValue)+"</span>":'<span class="text-red text-bold">'+cellValue.toString().replace(/\B(?<!\.\d*)(?=(\d{3})+(?!\d))/g,",")+"</span>",TransactionPrice:(cellValue,_options,_rowObject)=>"undefined"!=typeof Intl?cellValue>=1e6&&cellValue%1e6==0?cellValue=cellValue/1e6+"백만":new Intl.NumberFormat("ko-KR").format(cellValue):cellValue.toString().replace(/\B(?<!\.\d*)(?=(\d{3})+(?!\d))/g,","),Difference:(cellValue,_options,_rowObject)=>{if("undefined"!=typeof Intl){const nf=new Intl.NumberFormat("ko-KR",{minimumFractionDigits:2});return cellValue>=0?'<span class="text-red text-bold">+'+nf.format(cellValue)+"%</span>":'<span class="text-blue text-bold">'+nf.format(cellValue)+"%</span>"}return cellValue>=0?'<span class="text-red">'+cellValue.toString().replace(/\B(?<!\.\d*)(?=(\d{3})+(?!\d))/g,",")+"%</span>":'<span class="text-blue">'+cellValue.toString().replace(/\B(?<!\.\d*)(?=(\d{3})+(?!\d))/g,",")+"%</span>"},Price:(cellValue,_options,_rowObject)=>"undefined"!=typeof Intl?"$"+new Intl.NumberFormat("ko-KR",{minimumFractionDigits:1}).format(cellValue):"$"+cellValue.toString().replace(/\B(?<!\.\d*)(?=(\d{3})+(?!\d))/g,","),TotalPrice:(cellValue,_options,_rowObject)=>"undefined"!=typeof Intl?"$"+new Intl.NumberFormat("ko-KR",{minimumFractionDigits:1}).format(cellValue):"$"+cellValue.toString().replace(/\B(?<!\.\d*)(?=(\d{3})+(?!\d))/g,",")}};$((function(){$.extend($.fn.dataTable.defaults,{searching:!1,ordering:!0});const sidePanelWidth=$(".side--panel").width(),detailsWidth=$("main").width()-sidePanelWidth-20;API.getCurrency("",resp=>{if(resp.success){const requestQueue=[];resp.payload.map(item=>{const symbol=item.symbol,spotList=[],request=new Promise((resolve,_reject)=>{const data=[];API.requestSync(JSON.stringify(requestQueue),async res=>{res.map(payload=>{spotList[symbol]=payload});const spot=spotList[symbol].payload[0];data.push({name:item.name,meta_type:item.meta_type,meta_wp_production_date:item.meta_wp_production_date,price:item.price,price_open:spot.price_open?spot.price_open:item.price,price_close:spot.price_close?spot.price_close:item.price,icon_url:spot.icon_url?spot.icon_url:"about:blank",origin:item.meta_wp_origin,producer:item.meta_wp_producer,production_date:item.meta_wp_production_date,scent:item.meta_wp_scent,taste:item.meta_wp_taste,weight:item.meta_wp_weight,keep_method:item.meta_wp_keep_method,story:item.meta_wp_story,teamaster_note:item.meta_wp_teamaster_note,producer_note:item.meta_wp_producer_note,grade:item.meta_wp_grade,certificate:item.meta_certification_mark_name}),resolve(data)})});request.then(data=>{const grid=$("#jqGrid").on("draw.dt",()=>{const api=new $.fn.dataTable.Api("#jqGrid"),row=api.row(":eq(0)"),data=row.data();row.select();const name=data.name,symbol=data.symbol,type=data.meta_type,division=data.meta_division,producer=data.producer,production_date=data.production_date,origin=data.origin,icon_url=data.icon_url,scent=data.scent,taste=data.taste,weight=data.weight,story=data.story,keep_method=data.keep_method,teamaster_note=data.teamaster_note,producer_note=data.producer_note,grade=data.grade,certificate=data.certificate;API.getSpotPrice(symbol,resp=>{if(resp.success){const spot=resp.payload[0];$("#highest-price").text((parseFloat(spot.price_high)*parseFloat(spot.volume)).format()),$("#lowest-price").text((parseFloat(spot.price_low)*parseFloat(spot.volume)).format()),$("#spot-volume").text(spot.volume.format()),$("#spot-volume2").text((parseFloat(spot.price_close)*parseFloat(spot.volume)).format()),$(".details--price").text("$"+parseFloat(spot.price_close).toFixed(2));const diff=((spot.price_close-spot.price_open)/spot.price_open).toFixed(2),diffPercent=(100*diff).toFixed(2);$(".details--price").next("span").find(">span").text((diff>=0?"+":"")+diffPercent+"%"),$("#spot-diff").text(diff.format())}else alert(resp.error.message)}),$(".details--header .tea--name").text(name),$("#tab-info .division").text(division),$("#tab-info .type").text(type),$("#tab-info .producer").text(producer),$("#tab-info .certificate").text(certificate),$("#tab-info img").attr("src",icon_url),$("#white-paper [name=origin]").val(origin),$("#white-paper [name=producer]").val(producer),$("#white-paper [name=production_date]").val(production_date),$("#white-paper #taste").html(taste.replaceAll(/\r\n/g,"<br>")),$("#white-paper #scent").val(scent),$("#white-paper #weight").val(weight),$("#white-paper #keep-method").html(keep_method.replaceAll(/\r\n/g,"<br>")),$("#white-paper #story").html(story.replaceAll(/\r\n/g,"<br>")),$("#white-paper #teamaster-note").html(teamaster_note.replaceAll(/\r\n/g,"<br>")),$("#white-paper #producer-note").html(producer_note.replaceAll(/\r\n/g,"<br>")),$("#white-paper #grade").html(grade.replaceAll(/\r\n/g,"<br>"))}).DataTable({data:data,columns:[{data:"name",render:(data,_type,row)=>{const classOn=row.Checked?"btn--star--on":"btn--star";return`<button type="button" class="btn ${classOn}"></button>${data}`}},{data:"meta_type"},{data:"meta_wp_production_date"},{data:"price",render:(data,_type,row)=>{const diff=row.price_close-row.price_open;return"undefined"!=typeof Intl?diff>=0?'<span class="text-red text-bold">'+new Intl.NumberFormat("ko-KR").format(data)+"</span>":'<span class="text-blue text-bold">'+new Intl.NumberFormat("ko-KR").format(data)+"</span>":'<span class="text-red text-bold">'+data.replace(/\B(?<!\.\d*)(?=(\d{3})+(?!\d))/g,",")+"</span>"}},{data:(row,_type,_set)=>{const diff=(row.price_close-row.price_open)/row.price_open*100;return"undefined"!=typeof Intl?diff>=0?'<span class="text-red text-bold">+'+new Intl.NumberFormat("ko-KR",{minimumFractionDigits:2,maximumFractionDigits:2}).format(diff)+"%</span>":'<span class="text-blue text-bold">'+new Intl.NumberFormat("ko-KR").format(diff)+"%</span>":'<span class="text-red text-bold">'+diff.replace(/\B(?<!\.\d*)(?=(\d{3})+(?!\d))/g,",")+"</span>"}},{data:(row,_type,_set)=>{let price=row.price;return price>=1e6&&price%1e6==0?(price=price/1e6+"백만",price):price}}],columnDefs:[{targets:"_all",className:"dt-head-center"},{targets:"name",className:"dt-body-left",type:"title-string"},{targets:"meta_type",className:"dt-body-center"},{targets:"meta_wp_production_date",className:"dt-body-center",type:"any-number"},{targets:"price",className:"dt-body-right"},{targets:[-1,-2],className:"dt-body-right"}],responsive:!0,lengthChange:!1,select:!0,info:!1,paging:!1});function afterDraw(){grid.row(":eq(0)").select()}grid.on("select",(function(_e,_dt,type,indexes){if(console.log("hi"),"row"===type){const name=grid.rows(indexes).data().pluck("name")[0],symbol=grid.rows(indexes).data().pluck("symbol")[0],type=grid.rows(indexes).data().pluck("meta_type")[0],division=grid.rows(indexes).data().pluck("meta_division")[0],producer=grid.rows(indexes).data().pluck("producer")[0],production_date=grid.rows(indexes).data().pluck("production_date")[0],origin=grid.rows(indexes).data().pluck("origin")[0],icon_url=grid.rows(indexes).data().pluck("icon_url")[0],scent=grid.rows(indexes).data().pluck("scent")[0],taste=grid.rows(indexes).data().pluck("taste")[0],weight=grid.rows(indexes).data().pluck("weight")[0],story=grid.rows(indexes).data().pluck("story")[0],keep_method=grid.rows(indexes).data().pluck("keep_method")[0],teamaster_note=grid.rows(indexes).data().pluck("teamaster_note")[0],producer_note=grid.rows(indexes).data().pluck("producer_note")[0],grade=grid.rows(indexes).data().pluck("grade")[0],certificate=grid.rows(indexes).data().pluck("certificate")[0];API.getSpotPrice(symbol,resp=>{if(resp.success){const spot=resp.payload[0];console.log(spot),$("#highest-price").text((parseFloat(spot.price_high)*parseFloat(spot.volume)).format()),$("#lowest-price").text((parseFloat(spot.price_low)*parseFloat(spot.volume)).format()),$("#spot-volume").text(spot.volume.format()),$("#spot-volume2").text((parseFloat(spot.price_close)*parseFloat(spot.volume)).format()),$(".details--price").text("$"+parseFloat(spot.price_close).toFixed(2));const diff=((spot.price_close-spot.price_open)/spot.price_open).toFixed(2),diffPercent=(100*diff).toFixed(2);$(".details--price").next("span").find(">span").text((diff>=0?"+":"")+diffPercent+"%"),$("#spot-diff").text(diff.format())}else alert(resp.error.message)}),$(".details--header .tea--name").text(name),$("#tab-info .division").text(division),$("#tab-info .type").text(type),$("#tab-info .producer").text(producer),$("#tab-info .certificate").text(certificate),$("#tab-info img").attr("src",icon_url),$("#white-paper [name=origin]").val(origin),$("#white-paper [name=producer]").val(producer),$("#white-paper [name=production_date]").val(production_date),$("#white-paper #taste").html(taste.replaceAll(/\r\n/g,"<br>")),$("#white-paper #scent").val(scent),$("#white-paper #weight").val(weight),$("#white-paper #keep-method").html(keep_method.replaceAll(/\r\n/g,"<br>")),$("#white-paper #story").html(story.replaceAll(/\r\n/g,"<br>")),$("#white-paper #teamaster-note").html(teamaster_note.replaceAll(/\r\n/g,"<br>")),$("#white-paper #producer-note").html(producer_note.replaceAll(/\r\n/g,"<br>")),$("#white-paper #grade").html(grade.replaceAll(/\r\n/g,"<br>"))}}))})})}}),$("#detailsGrid").jqGrid({url:"data2.json",datatype:"json",colModel:[{label:"번호",name:"Num",width:99*detailsWidth/834,align:"center",resizable:!1},{label:"구분",name:"Category",width:96*detailsWidth/834,align:"center",resizable:!1},{label:"등록일",name:"CreatedAt",width:68*detailsWidth/834,align:"center",formatter:"date",formatoptions:{srcformat:"Y/m/d",newformat:"Y/m/d"},resizable:!1},{label:"가격",name:"Price",width:92*detailsWidth/834,formatter:Exchange.Price,align:"right",sorttype:"number",resizable:!1},{label:"수량",name:"Quantity",width:123*detailsWidth/834,sorttype:"number",align:"center",resizable:!1},{label:"총액",name:"TotalPrice",width:92*detailsWidth/834,sorttype:"integer",align:"right",formatter:Exchange.TotalPrice,resizable:!1},{label:"상태",name:"Status",width:148*detailsWidth/834,align:"center",resizable:!1},{label:"거래버튼",width:70*detailsWidth/834,formatter:_cellValue=>'<button type="button" class="btn btn--blue btn--rounded" data-toggle="modal" data-target="#modal-sell" style="width: 100%; height: 25px; line-height: 25px">판매</button>'}],loadonce:!0,width:detailsWidth,height:352,rowNum:20,viewrecords:!0,shrinkToFit:!1}),$("#detailsGrid2").jqGrid({url:"data2.json",datatype:"json",rownumbers:!1,colModel:[{label:"번호",name:"Num",width:99*detailsWidth/834,align:"center",resizable:!1},{label:"구분",name:"Category",width:96*detailsWidth/834,align:"center",resizable:!1},{label:"등록일",name:"CreatedAt",width:68*detailsWidth/834,align:"center",formatter:"date",formatoptions:{srcformat:"Y/m/d",newformat:"Y/m/d"},resizable:!1},{label:"가격",name:"Price",width:92*detailsWidth/834,formatter:Exchange.formatter.Price,align:"right",sorttype:"number",resizable:!1},{label:"수량",name:"Quantity",width:123*detailsWidth/834,sorttype:"number",align:"center",resizable:!1},{label:"총액",name:"TotalPrice",width:92*detailsWidth/834,sorttype:"integer",align:"right",formatter:cellValue=>"undefined"!=typeof Intl?"$"+new Intl.NumberFormat("ko-KR",{minimumFractionDigits:1}).format(cellValue):"$"+cellValue.toString().replace(/\B(?<!\.\d*)(?=(\d{3})+(?!\d))/g,","),resizable:!1},{label:"상태",name:"Status",width:148*detailsWidth/834,align:"center",resizable:!1},{label:"거래버튼",width:70*detailsWidth/834,formatter:_cellValue=>'<button type="button" class="btn btn--red btn--rounded" data-toggle="modal" data-target="#modal-buy" style="width: 100%; height: 25px; line-height: 25px">구매</button>'}],loadonce:!0,width:detailsWidth,height:308,rowNum:20,viewrecords:!0,shrinkToFit:!1}),$("#modal-buy").submit(()=>($("#alert-buy").addClass("modal--open"),!1));const period=$("#period").dropdown("selected");API.getChartData("btc",period,resp=>{displayChart(resp)})}));const getData=async()=>{const res=await fetch("data.csv"),resp=await res.text(),cdata=resp.split("\n").map(row=>{const[time1,time2,open,high,low,close,volume]=row.split(",");return{time:new Date(`${time1}, ${time2}`).getTime()/1e3,open:1*open,high:1*high,low:1*low,close:1*close,volume:1*volume}});return cdata},genVolumeData=data=>{let previous_close=0;const rdata=data.map(row=>{console.log(row);const price_decrease_color="rgba(255,82,82, 0.8)",price_increase_color="rgba(0, 150, 136, 0.8)",price_color=previous_close<=row.close?price_increase_color:price_decrease_color;return previous_close=row.close,{time:row.time,value:1*row.volume,color:price_color}});return rdata};var height=300;const sidePanelWidth=$(".side--panel").width(),detailsWidth=$("main").width()-sidePanelWidth-20,container=document.getElementById("tvchart"),chart=LightweightCharts.createChart(container,{width:detailsWidth,height:height,crosshair:{mode:LightweightCharts.CrosshairMode.Normal}});var candleSeries=chart.addCandlestickSeries(),volumeSeries=chart.addHistogramSeries({color:"#26a69a",priceFormat:{type:"volume"},priceScaleId:"",scaleMargins:{top:.8,bottom:0}});const displayChart=async(data,period="1d")=>{function addSMAtoChart(data,cnt,color,line_width){var smaData=calculateSMA(data,cnt),smaLine;chart.addLineSeries({color:color||"rgba(4, 111, 232, 1)",lineWidth:line_width||1}).setData(smaData)}function calculateSMA(data,count){for(var avg=function(data){for(var sum=0,i=0;i<data.length;i++)sum+=data[i].close;return sum/data.length},result=[],i=count-1,len=data.length;i<len;i++){var val=avg(data.slice(i-count+1,i));result.push({time:data[i].time,value:val})}return result}function fillBarsSegment(left,right,points){for(var deltaY,deltaX,angle=(right.price-left.price)/(right.index-left.index),i=left.index;i<=right.index;i++){var basePrice=left.price+(i-left.index)*angle,openNoise,closeNoise,open=basePrice*(.1-.2*Math.random()+1),close=basePrice*(.1-.2*Math.random()+1),high=Math.max(basePrice*(1+.2*Math.random()),open,close),low=Math.min(basePrice*(1-.2*Math.random()),open,close);points[i].open=open,points[i].high=high,points[i].low=low,points[i].close=close}}function generateControlPoints(res,period,dataMultiplier){var time=void 0!==period?period.timeFrom:{day:1,month:1,year:2018},timeTo,days=getDiffDays(time,void 0!==period?period.timeTo:{day:1,month:1,year:2019});dataMultiplier=dataMultiplier||1;var controlPoints=[];controlPoints.push({index:0,price:getRandomPrice()*dataMultiplier});for(var i=0;i<days;i++)i>0&&i<days-1&&Math.random()<.05&&controlPoints.push({index:i,price:getRandomPrice()*dataMultiplier}),res.push({time:time}),time=nextBusinessDay(time);return controlPoints.push({index:res.length-1,price:getRandomPrice()*dataMultiplier}),controlPoints}function getDiffDays(dateFrom,dateTo){var df=convertBusinessDayToUTCTimestamp(dateFrom),dt=convertBusinessDayToUTCTimestamp(dateTo),diffTime=Math.abs(dt.getTime()-df.getTime());return Math.ceil(diffTime/864e5)}function convertBusinessDayToUTCTimestamp(date){return new Date(Date.UTC(date.year,date.month-1,date.day,0,0,0,0))}function nextBusinessDay(time){var d=convertBusinessDayToUTCTimestamp({year:time.year,month:time.month,day:time.day+1});return{year:d.getUTCFullYear(),month:d.getUTCMonth()+1,day:d.getUTCDate()}}function getRandomPrice(){return 10+Math.round(1e4*Math.random())/100}candleSeries.setData(data),volumeSeries.setData(genVolumeData(data)),addSMAtoChart(data,10,"#F00"),addSMAtoChart(data,30,"#0F0"),addSMAtoChart(data,90,"#00F")};$(".tab--sell").click(e=>{API.getTradingList(()=>{})});
//# sourceMappingURL=exchange.min.js.map