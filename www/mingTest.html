<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>슬라이드 뷰어 (통합)</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    html, body {
      margin: 0;
      padding: 0;
      width: 100vw;
      height: 100vh;
      min-height: 100vh;
      min-width: 100vw;
      overflow: hidden;
      font-family: 'Noto Sans KR', '맑은 고딕', 'Malgun Gothic', Arial, sans-serif;
      background: #f8f8f8;
    }
    body {
      background: #fff;
      width: 100vw;
      height: 100vh;
      position: relative;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    #app {
      width: 100vw;
      height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    #tabbar-modal-overlay {
      display: none;
      position: fixed;
      left: 0; top: 0; right: 0; bottom: 0;
      width: 100vw;
      height: 100vh;
      background: rgba(0,0,0,0.35);
      z-index: 9998;
    }
    #tabbar-container {
      width: auto;
      min-width: 340px;
      max-width: 90vw;
      display: none;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      position: fixed;
      left: 50%;
      top: 50%;
      transform: translate(-50%, -50%);
      background: #fff;
      border-radius: 18px;
      box-shadow: 0 8px 32px 0 rgba(0,0,0,0.18);
      z-index: 9999;
      padding: 32px 32px 18px 32px;
    }
    #tabbar-container.show-tabbar {
      display: flex;
    }
    #tabbar-container.show-tabbar ~ #tabbar-modal-overlay {
      display: block;
    }
    #tabbar {
      display: flex;
      gap: 8px;
      margin: 0 0 18px 0;
    }
    .tab {
      background: #f2f2f2;
      border: 1px solid #ccc;
      border-radius: 8px 8px 0 0;
      padding: 10px 22px;
      font-size: 1rem;
      cursor: pointer;
      transition: background 0.2s, color 0.2s;
    }
    .tab.active {
      background: #222;
      color: #fff;
      border-bottom: 2px solid #222;
    }
    #searchbox {
      display: flex;
      align-items: center;
      gap: 8px;
      margin-bottom: 8px;
    }
    #searchInput {
      padding: 8px 14px;
      font-size: 1rem;
      border: 1px solid #bbb;
      border-radius: 6px;
      outline: none;
    }
    #searchBtn {
      padding: 8px 18px;
      font-size: 1rem;
      background: #222;
      color: #fff;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      transition: background 0.2s;
    }
    #searchBtn:hover {
      background: #444;
    }
    .slide-container {
      width: 100vw;
      height: 100vh;
      max-width: 100vw;
      max-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      position: relative;
      pointer-events: auto;
      overflow: hidden;
    }
    .slide {
      width: 100vw;
      height: 100vh;
      max-width: 100vw;
      max-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      overflow: hidden;
      position: relative;
      pointer-events: auto;
    }
    .slide-bg {
      position: absolute;
      left: 50%;
      top: 50%;
      transform: translate(-50%, -50%);
      width: auto;
      height: 100vh;
      max-width: 100vw;
      object-fit: contain;
      z-index: 0;
      pointer-events: none;
    }
    .arrow {
      position: absolute;
      top: 50%;
      font-size: 3.5rem;
      color: #333;
      background: transparent;
      border: none;
      cursor: pointer;
      z-index: 2;
      padding: 0.1em 0.4em;
      border-radius: 0.5em;
      user-select: none;
      opacity: 0;
      transition: opacity 0.3s, box-shadow 0.2s, background 0.2s;
      pointer-events: auto;
      font-family: 'Arial Black', Arial, sans-serif;
      font-weight: bold;
      line-height: 1;
      box-shadow: 0 2px 8px 0 rgba(0,0,0,0.10);
      border: 1.5px solid #e0e0e0;
    }
    .arrow.left { left: 32px; }
    .arrow.right { right: 32px; }
    .arrow:hover, .arrow:focus, .arrow:active {
      opacity: 1;
      background: rgba(255,255,255,0.85);
    }
    .arrow:not(:hover):not(:focus):not(:active) {
      opacity: 0;
      background: transparent;
    }
    .textArea {
      position: absolute;
      display: flex;
      flex-direction: column;
      align-items: flex-start;
      justify-content: flex-start;
      text-align: left;
      width: auto;
      pointer-events: auto;
      overflow: hidden;
      left: 200px;
      top: 700px;
      margin-top: 0;
      padding-left: 3px;
    }
    .textArea p {
      margin: 0 0 0.2em 0;
      font-family: 'Noto Sans KR', '맑은 고딕', 'Malgun Gothic', Arial, sans-serif;
      font-size: clamp(11px, 2.5vw, 30px);
      font-weight: 900;
      filter: drop-shadow(1px 0 white) drop-shadow(-1px 0 white)
        drop-shadow(0 1px white) drop-shadow(0 -1px white)
        drop-shadow(1px 1px white) drop-shadow(-1px -1px white)
        drop-shadow(1px -1px white) drop-shadow(-1px 1px white);
      user-select: none;
      cursor: default;
      letter-spacing: 0.036em;
      line-height: 0.68em;
      opacity: 0;
      background: transparent;
      color: #222;
      transition: opacity 1.2s cubic-bezier(0.4,0,0.2,1), transform 1.2s cubic-bezier(0.4,0,0.2,1);
      text-align: left;
      width: auto;
      box-sizing: initial;
      word-break: normal;
      pointer-events: none;
      overflow: visible;
      transform: translateY(-30px);
    }
    .textArea p.visible, .textArea p.done {
      opacity: 1;
      transform: translateY(0);
      transition: opacity 1.2s cubic-bezier(0.4,0,0.2,1), transform 1.2s cubic-bezier(0.4,0,0.2,1);
    }
    @media (max-width: 900px) {
      .slide {
        width: 100vw;
        height: 56.25vw;
        max-width: 100vw;
        max-height: 100vh;
      }
      .textArea {
        left: 4vw !important;
        top: 30vw !important;
        padding-left: 1vw !important;
        margin-top: 0 !important;
        transform: none !important;
        z-index: 10 !important;
      }
      .textArea p {
        font-size: clamp(11px, 2.5vw, 30px);
        max-width: 92vw;
        letter-spacing: 0.036em;
        line-height: 1.10em;
      }
      #tabbar-container {
        min-width: 180px;
        max-width: 98vw;
        padding: 12px 6px 8px 6px;
        border-radius: 10px;
      }
      #tabbar {
        gap: 3px;
        margin: 0 0 8px 0;
      }
      .tab {
        padding: 5px 8px;
        font-size: 0.85rem;
        border-radius: 6px 6px 0 0;
      }
      #searchbox {
        gap: 3px;
        margin-bottom: 4px;
      }
      #searchInput {
        padding: 4px 7px;
        font-size: 0.85rem;
        border-radius: 4px;
      }
      #searchBtn {
        padding: 4px 10px;
        font-size: 0.85rem;
        border-radius: 4px;
      }
      #tabbar-close-btn {
        margin-top: 6px;
        padding: 4px 12px;
        font-size: 0.85rem;
        border-radius: 4px;
      }
    }
    @media (min-width: 901px) {
      .slide {
        width: 100vw;
        height: 56.25vw;
        max-width: 100vw;
        max-height: 100vh;
      }
      .textArea p {
        font-size: clamp(11px, 2.5vw, 30px);
        max-width: none;
        letter-spacing: 0.036em;
        line-height: 1.10em;
      }
    }
  </style>
</head>
<body>
  <div id="tabbar-container">
    <div id="tabbar">
      <button class="tab" data-label="BBC News">BBC News</button>
      <button class="tab" data-label="BBC Earth">BBC Earth</button>
      <button class="tab" data-label="NatGeo">NatGeo</button>
      <button class="tab" data-label="NatGeo Wild">NatGeo Wild</button>
      <button class="tab" data-label="NatGeo Kids">NatGeo Kids</button>
    </div>
    <div id="searchbox">
      <input type="text" id="searchInput" placeholder="검색어를 입력하세요" />
      <button id="searchBtn">Search</button>
    </div>
  </div>
  <div id="tabbar-modal-overlay"></div>
  <div id="app"></div>
  <script>
// Model
const slides = [
  {
    bg: 'http://visitnpc.com/test/free/common/img/02.webp',
    text: [
      'What can you see',
      'when you look up at the night sky?',
      'Countless stars twinkle',
      'in the sky when the Sun sleeps.'
    ],
    textPos: { left: '7%', top: '78%' }
  },
  {
    bg: 'http://visitnpc.com/test/free/common/img/03.webp',
    text: [
      'The night sky, a world filled with',
      'stars, is called the universe.',
      'So, how did the universe come',
      'to be?'
    ],
    textPos: { left: '12%', top: '74%' }
  }
];

let current = 0;
let textAnimated = [false, false]; // 각 페이지별 애니메이션 여부

// 커스텀 팝업 함수(laypop)
function laypop(message) {
  // 기존 alert 대신 tabbar 모달만 보이게 (팝업 제거)
  const tabbar = document.getElementById('tabbar-container');
  const overlay = document.getElementById('tabbar-modal-overlay');
  if (tabbar) tabbar.classList.add('show-tabbar');
  if (overlay) overlay.style.display = 'block';
  // inputbox에 클릭한 단어 넣기
  const searchInput = document.getElementById('searchInput');
  if (searchInput) searchInput.value = message;
  // tabbar가 열릴 때마다 첫 번째 탭(BBC News) active
  const tabs = document.querySelectorAll('.tab');
  tabs.forEach(tab => tab.classList.remove('active'));
  if (tabs[0]) tabs[0].classList.add('active');
}

function makeNounSpan(word) {
  const span = document.createElement('span');
  span.textContent = word;
  span.style.cursor = 'pointer';
  span.style.pointerEvents = 'auto';
  span.addEventListener('click', function(e) {
    e.stopPropagation();
    laypop(word);
  });
  return span;
}

function renderSlide(idx) {
  const slide = slides[idx];
  const app = document.getElementById('app');
  app.innerHTML = '';

  // 슬라이드 컨테이너
  const container = document.createElement('div');
  container.className = 'slide-container';

  // 왼쪽 화살표
  const leftArrow = document.createElement('button');
  leftArrow.className = 'arrow left';
  leftArrow.innerHTML = '&#60;';
  leftArrow.tabIndex = -1;
  leftArrow.addEventListener('click', prevSlide);
  container.appendChild(leftArrow);

  // 슬라이드(배경)
  const slideDiv = document.createElement('div');
  slideDiv.className = 'slide';
  const img = document.createElement('img');
  img.className = 'slide-bg';
  img.src = slide.bg;
  img.alt = 'slide';
  slideDiv.appendChild(img);
  container.appendChild(slideDiv);

  // 오른쪽 화살표
  const rightArrow = document.createElement('button');
  rightArrow.className = 'arrow right';
  rightArrow.innerHTML = '&#62;';
  rightArrow.tabIndex = -1;
  rightArrow.addEventListener('click', nextSlide);
  container.appendChild(rightArrow);

  // 텍스트 영역
  const textArea = document.createElement('div');
  textArea.className = 'textArea';
  textArea.style.left = '200px'; // 1,2페이지 모두 200px로 고정
  textArea.style.paddingLeft = '3px'; // 공통 padding-left
  textArea.style.top = '700px';
  textArea.style.marginTop = '20px';
  textArea.style.transform = 'translateY(-700px)';

  // 각 줄별로 명사에만 클릭 이벤트 적용
  slide.text.forEach((line, i) => {
    const p = document.createElement('p');
    // 1페이지(0)와 2페이지(1)별로 명사 위치 다르게 처리
    if (idx === 0) {
      if (i === 1) {
        const before = 'when you look up at the night ';
        const noun = 'sky';
        const after = '?';
        p.appendChild(document.createTextNode(before));
        p.appendChild(makeNounSpan(noun));
        p.appendChild(document.createTextNode(after));
      } else if (i === 2) {
        const before = 'Countless ';
        const noun = 'stars';
        const after = ' twinkle';
        p.appendChild(document.createTextNode(before));
        p.appendChild(makeNounSpan(noun));
        p.appendChild(document.createTextNode(after));
      } else if (i === 3) {
        const before = 'in the ';
        const noun1 = 'sky';
        const middle = ' when the ';
        const noun2 = 'Sun';
        const after = ' sleeps.';
        p.appendChild(document.createTextNode(before));
        p.appendChild(makeNounSpan(noun1));
        p.appendChild(document.createTextNode(middle));
        p.appendChild(makeNounSpan(noun2));
        p.appendChild(document.createTextNode(after));
      } else {
        p.textContent = line;
      }
    } else if (idx === 1) {
      // 2페이지 명사: "night sky", "world", "stars", "universe"
      if (i === 0) {
        // 'The night sky, a world filled with'
        const before1 = 'The ';
        const noun1 = 'night sky';
        const comma = ', a ';
        const noun2 = 'world';
        const after = ' filled with';
        p.appendChild(document.createTextNode(before1));
        p.appendChild(makeNounSpan(noun1));
        p.appendChild(document.createTextNode(comma));
        p.appendChild(makeNounSpan(noun2));
        p.appendChild(document.createTextNode(after));
      } else if (i === 1) {
        // 'stars, is called the universe.'
        const noun1 = 'stars';
        const middle = ', is called the ';
        const noun2 = 'universe';
        const after = '.';
        p.appendChild(makeNounSpan(noun1));
        p.appendChild(document.createTextNode(middle));
        p.appendChild(makeNounSpan(noun2));
        p.appendChild(document.createTextNode(after));
      } else if (i === 2) {
        // 'So, how did the universe come'
        const before = 'So, how did the ';
        const noun = 'universe';
        const after = ' come';
        p.appendChild(document.createTextNode(before));
        p.appendChild(makeNounSpan(noun));
        p.appendChild(document.createTextNode(after));
      } else {
        p.textContent = line;
      }
    } else {
      p.textContent = line;
    }
    textArea.appendChild(p);
  });
  slideDiv.appendChild(textArea);

  app.appendChild(container);

  // 텍스트 애니메이션
  if (!textAnimated[idx]) {
    animateText(textArea);
    textAnimated[idx] = true;
  } else {
    // 이미 본 페이지는 애니메이션 없이 바로 표시
    const ps = textArea.querySelectorAll('p');
    ps.forEach(p => p.classList.add('done'));
  }

  // 화살표 위치(top) 조정
  positionArrows(img, leftArrow, rightArrow);

  // 드래그/터치 이벤트
  addDragEvents(container, leftArrow, rightArrow);

  // 리사이즈 시 위치 재조정
  window.onresize = () => {
    positionArrows(img, leftArrow, rightArrow);
    positionTextArea(img, textArea, slide.textPos);
    // 2페이지에서 left가 250px 초과 시 강제 고정
    if (idx === 1) {
      const leftValue = parseFloat(window.getComputedStyle(textArea).left);
      if (leftValue > 250) {
        textArea.style.setProperty('left', '250px', 'important');
      }
    }
  };
  // 이미지 로드 후 위치 재조정
  img.onload = () => {
    positionArrows(img, leftArrow, rightArrow);
    positionTextArea(img, textArea, slide.textPos);
    // 2페이지에서 left가 250px 초과 시 강제 고정
    if (idx === 1) {
      const leftValue = parseFloat(window.getComputedStyle(textArea).left);
      if (leftValue > 250) {
        textArea.style.setProperty('left', '250px', 'important');
      }
    }
  };
}

function animateText(textArea) {
  const ps = textArea.querySelectorAll('p');
  ps.forEach(p => { p.classList.remove('visible', 'done'); });
  ps.forEach((p, i) => {
    setTimeout(() => { p.classList.add('visible'); }, 400 + i * 500);
  });
}

function positionArrows(imgElem, leftArrow, rightArrow) {
  if (!imgElem || !leftArrow || !rightArrow) return;
  const imgRect = imgElem.getBoundingClientRect();
  const slideRect = imgElem.parentElement.getBoundingClientRect();
  leftArrow.style.top = (imgRect.top - slideRect.top + imgRect.height/2) + 'px';
  rightArrow.style.top = (imgRect.top - slideRect.top + imgRect.height/2) + 'px';
  leftArrow.style.transform = 'translateY(-50%)';
  rightArrow.style.transform = 'translateY(-50%)';
}

function positionTextArea(imgElem, textArea, pos) {
  if (!imgElem || !textArea) return;
  const rect = imgElem.getBoundingClientRect();
  const slideRect = imgElem.parentElement.getBoundingClientRect();
  // % 기준 위치
  if (pos.left && pos.left.includes('%')) {
    const left = rect.left - slideRect.left + rect.width * (parseFloat(pos.left)/100);
    textArea.style.left = left + 'px';
  }
  if (pos.top && pos.top.includes('%')) {
    const top = rect.top - slideRect.top + rect.height * (parseFloat(pos.top)/100);
    textArea.style.top = top + 'px';
    textArea.style.transform = `translateY(-${pos.top})`;
  }
}

function prevSlide() {
  current = (current - 1 + slides.length) % slides.length;
  renderSlide(current);
}
function nextSlide() {
  current = (current + 1) % slides.length;
  renderSlide(current);
}

function addDragEvents(container, leftArrow, rightArrow) {
  let startX = null;
  let dragging = false;
  container.onmousedown = e => { startX = e.clientX; dragging = true; };
  container.onmousemove = e => { if (!dragging) return; };
  container.onmouseup = e => {
    if (!dragging) return;
    const diff = e.clientX - startX;
    if (diff > 60) leftArrow.click();
    else if (diff < -60) rightArrow.click();
    dragging = false;
    startX = null;
  };
  // 모바일 터치
  container.ontouchstart = e => { startX = e.touches[0].clientX; dragging = true; };
  container.ontouchmove = e => { if (!dragging) return; };
  container.ontouchend = e => {
    if (!dragging) return;
    const endX = e.changedTouches[0].clientX;
    const diff = endX - startX;
    if (diff > 60) leftArrow.click();
    else if (diff < -60) rightArrow.click();
    dragging = false;
    startX = null;
  };
}

// 첫 슬라이드 표시
window.onload = () => renderSlide(current);

// 탭바 및 검색 인풋 이벤트 처리
window.addEventListener('DOMContentLoaded', () => {
  const tabs = document.querySelectorAll('.tab');
  const searchInput = document.getElementById('searchInput');
  // 기본적으로 BBC News 탭 클릭 상태
  tabs.forEach(tab => tab.classList.remove('active'));
  if (tabs[0]) tabs[0].classList.add('active');
  // 탭 클릭 시 inputbox에 내용 넣는 기능 제거
  tabs.forEach(tab => {
    tab.addEventListener('click', function() {
      tabs.forEach(t => t.classList.remove('active'));
      this.classList.add('active');
    });
  });
  // Search 버튼 기능: 탭에 따라 유튜브 채널 주소로 새 창 띄우기
  document.getElementById('searchBtn').addEventListener('click', function() {
    const tabToChannel = {
      'BBC News': 'UC16niRr50-MSBwiO3YDb3RA',
      'BBC Earth': 'UCwmZiChSryoWQCZMIQezgTg',
      'NatGeo': 'UCpVm7bg6pXKo1Pr6k5kxG9A',
      'NatGeo Wild': 'UCDPk9MG2RexnOMGTD-YnSnA',
      'NatGeo Kids': 'UCXVCgDuD_QCkI7gTKU7-tpg'
    };
    const activeTab = document.querySelector('.tab.active');
    const tabLabel = activeTab ? activeTab.dataset.label : 'BBC News';
    const channelId = tabToChannel[tabLabel] || tabToChannel['BBC News'];
    const query = encodeURIComponent(searchInput.value);
    const url = `https://www.youtube.com/channel/${channelId}/search?query=${query}`;
    window.open(url, '_blank');
  });
  // 닫기 버튼 동적 추가
  const tabbar = document.getElementById('tabbar-container');
  if (tabbar && !document.getElementById('tabbar-close-btn')) {
    const closeBtn = document.createElement('button');
    closeBtn.id = 'tabbar-close-btn';
    closeBtn.textContent = 'close';
    closeBtn.style.marginTop = '12px';
    closeBtn.style.padding = '8px 24px';
    closeBtn.style.fontSize = '1rem';
    closeBtn.style.background = '#222';
    closeBtn.style.color = '#fff';
    closeBtn.style.border = 'none';
    closeBtn.style.borderRadius = '6px';
    closeBtn.style.cursor = 'pointer';
    closeBtn.style.transition = 'background 0.2s';
    closeBtn.addEventListener('mouseover', () => closeBtn.style.background = '#444');
    closeBtn.addEventListener('mouseout', () => closeBtn.style.background = '#222');
    closeBtn.addEventListener('click', () => {
      tabbar.classList.remove('show-tabbar');
      const overlay = document.getElementById('tabbar-modal-overlay');
      if (overlay) overlay.style.display = 'none';
    });
    tabbar.appendChild(closeBtn);
  }
  // 오버레이 클릭 시 닫기
  const overlay = document.getElementById('tabbar-modal-overlay');
  if (overlay) {
    overlay.addEventListener('click', () => {
      if (tabbar) tabbar.classList.remove('show-tabbar');
      overlay.style.display = 'none';
    });
  }
});
  </script>
</body>
</html> 