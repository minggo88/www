$(function(){const e=$("#email"),a=$("#password");let o="",c="",t="",n=0,r=0;API.getCountry(e=>{let a="";e.payload.map(e=>{a||(a=e.code.toLowerCase()),$("#country").dropdown("add",{value:e.code.toLowerCase(),text:`<i class="flag ${e.code.toLowerCase()}"></i> ${e.name}`})}),$("#country").dropdown("select",a).dropdown("add_search")}),$("#create-account-country").on("submit",e=>(e.preventDefault(),window.sessionStorage.country=$("#country").dropdown("selected"),$("#create-account-country").hide(),$("#create-account-info").show(),!1)),$("#create-account-info").on("submit",c=>(c.preventDefault(),e.val()?!1===/^\w+([\.-]?\w+)*@\w+([\.-]?\w+)*(\.\w{2,3})+$/.test(e.val())?(e.focus(),alert("올바른 E-mail 주소를 입력해주세요"),!1):a.val()?($("#create-account-info").addClass("loading"),$("#create-account-info input[type=submit]").prop("disabled",!0),API.sendEmailConfirmCode(e.val(),a=>{$("#create-account-info").removeClass("loading"),a.success?(o=e.val(),$("#create-account-info").hide(),$("#create-account-mail-auth").show().find(".grid--code>input:eq(0)").focus()):($("#create-account-info input[type=submit]").prop("disabled",!1),alert(a.error.message))}),!1):(a.focus(),!1):(e.focus(),!1))),$('[name="btn-resend-email"]').on("click",function(){return $("#create-account-mail-auth").addClass("loading"),API.sendEmailConfirmCode(o,e=>{$("#create-account-mail-auth").removeClass("loading"),e.success?$("#create-account-mail-auth").show().find(".grid--code>input:eq(0)").focus():alert(e.error.message)}),!1}),$("#create-account-mail-auth").on("submit",a=>{a.preventDefault();let o="";return $("#create-account-mail-auth .grid--code input[type=number]").each((e,a)=>{if(!$(a).val())return check=!1,void $(a).focus();o+=$(a).val()}),$("#create-account-mail-auth").addClass("loading"),$("#create-account-mail-auth input[type=submit]").prop("disabled",!0),API.checkEmailConfirmCode(e.val(),o,e=>{$("#create-account-mail-auth").removeClass("loading"),e.success?(n=1,$("#create-account-mail-auth").hide(),$("#create-account-phone").show()):(n=0,$("#create-account-mail-auth input[type=submit]").prop("disabled",!1),alert(e.error.message))}),!1}),$("#create-account-phone").on("submit",e=>{e.preventDefault();const a=$("#phoneCountry").val(),o=$("#phone").val();return a?o?($("#create-account-phone").addClass("loading"),$("#create-account-phone input[type=submit]").prop("disabled",!0),API.sendMobileConfirmCode(a,o,e=>{e.success?(c=a,t=o,$("#create-account-phone").hide(),$("#create-account-phone-auth").show()):($("#create-account-phone input[type=submit]").prop("disabled",!1),alert(e.error.message))}),!1):($("#phone").focus(),!1):($("#phoneCountry").focus(),!1)}),$('[name="btn-resend-sms"]').on("click",function(){if(c&&t)return $("#create-account-phone-auth").addClass("loading"),API.sendMobileConfirmCode(c,t,e=>{$("#create-account-phone-auth").removeClass("loading"),e.success||alert(e.error.message)}),!1}),$("#create-account-phone-auth").on("submit",()=>{let e="",a=!0;return $("#create-account-phone-auth .grid--code input[type=number]").each((o,c)=>{if(!$(c).val())return a=!1,void $(c).focus();e+=$(c).val()}),a&&($("#create-account-phone-auth").addClass("loading"),$("#create-account-phone-auth input[type=submit]").prop("disabled",!0),API.checkMobileConfirmCode(phone,e=>{$("#create-account-phone-auth").removeClass("loading"),e.success?(r=1,$("#create-account-phone-auth").hide(),$("#create-account-pin-number").show()):(r=0,$("#create-account-phone-auth input[type=submit]").prop("disabled",!1),alert(e.error.message))})),!1}),$("#create-account-pin-number").on("submit",()=>{for(i=0;i<6;i++){const e=$("#create-account-pin-number input[name=pin]:eq("+i+")");if(!$.trim(e.val())){e.focus();break}}return $("#create-account-pin-number").hide(),$("#create-account-pin-number-confirm").hide(),!1}),$("#create-account-pin-number-confirm").on("submit",()=>{let o="",t="",i=!0;return $("#create-account-pin-number .grid--code input[type=number]").each(e=>{o+=$(e).val()}),$("#create-account-pin-number-confirm .grid--code input[type=number]").each(e=>{if(!$(e).val())return i=!1,void $(e).focus();t+=$(e).val()}),o!==t&&(alert("핀번호가 다릅니다"),i=!1),i&&($("#create-account-pin-number-confirm").addClass("loading"),API.join({social_id:e.val(),social_name:"",email:e.val(),userpw:a.val(),mobile_calling_code:c,mobile_country_code:(window.sessionStorage.country+"").toUpperCase(),pin:o,bool_email:$("#mailing").is(":checked")?1:0,bool_marketing:$("#marketing").is(":checked")?1:0,bool_confirm_email:n,bool_confirm_mobile:r},e=>{$("#create-account-pin-number-confirm").removeClass("loading"),e.success?($("#create-account-pin-number").hide(),$("#create-account-pin-number-confirm").hide()):alert(e.error.message)})),!1})});