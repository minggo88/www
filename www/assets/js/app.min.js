function disableclick(e){if(2==e.button)return!1}function setCookie(e,t,n){var a=new Date;a.setDate(a.getDate()+n),document.cookie=e+"="+escape(t)+"; path=/; expires="+a.toGMTString()+";"}function getCookie(e){for(var t=e+"=",n=0;n<=document.cookie.length;){var a=n+t.length;if(document.cookie.substring(n,a)==t){-1==(endOfCookie=document.cookie.indexOf(";",a))&&(endOfCookie=document.cookie.length);var o=unescape(document.cookie.substring(a,endOfCookie));return"undefined"==o?"":o}if(n=document.cookie.indexOf(" ",n)+1,0==n)break}return""}function getURLParameter(e,t){return t=new URL(t||window.location.href),r=t.searchParams.get(e),r||""}function setURLParameter(e,t,n){return n=new URL(n||window.location.href),n.searchParams.set(e,t),n.href}function input_filter_number(e){let t=e.which?e.which:event.keyCode,n=String.fromCharCode(t);if(n.match(/[^0-9]/g)&&8!=t&&9!=t&&46!=t&&35!=t&&36!=t&&37!=t&&38!=t&&39!=t&&40!=t&&96!=t&&97!=t&&98!=t&&99!=t&&100!=t&&101!=t&&102!=t&&103!=t&&104!=t&&105!=t&&48!=t&&49!=t&&50!=t&&51!=t&&52!=t&&53!=t&&54!=t&&55!=t&&56!=t&&57!=t)return!1}function htmlencode(e){return e.replace(/[&<>"']/g,function(e){return"&"+{"&":"amp","<":"lt",">":"gt",'"':"quot","'":"#39"}[e]+";"})}$("label,.btn,button,a,th").on("contextmenu selectstart dragstart",function(){return!1}),$("body").on("contextmenu",function(){return!1}),document.onmousedown=disableclick,$(document).ready(function(){$(document).bind("keydown",function(e){get_keycode(e);if(123==e.keyCode)return e.preventDefault(),e.returnValue=!1,!1})}),function(){const e=function(e,t){for(i in t)if(t[i]==e)return!0;return!1},t=["en","zh","ja","vi","th","ko"],n="ko";var a={},o=navigator.language||navigator.userLanguage,s=window.localStorage.locale;o=o.substr(0,2),o=n,o=s&&s!==o&&e(s,t)?s:o,window.localStorage.locale!==o&&(window.localStorage.locale=o),window.lang!==o&&(window.lang=o);const l=function(e){$("[data-i18n]").each(function(){const t=$(this).html(),n=e[t]?e[t]:"";n&&$(this).html(n)})},c=function(e){let t=Math.ceil((new Date).getTime()/1e3/3600),n="/i18n/"+o+"/LC_MESSAGES/WWW.json?v="+t;httpRequest=new XMLHttpRequest,httpRequest&&(httpRequest.onreadystatechange=function(){httpRequest.readyState===XMLHttpRequest.DONE&&(200===httpRequest.status&&(r=JSON.parse(httpRequest.responseText),a=r.data,l(a)),e&&"function"==typeof e&&e())},httpRequest.open("GET",n),httpRequest.send())};c(),window.__=function(e){return a&&a[e]?a[e]:e},window._e=function(e){document.write(__(e))},window._c=function(a,i){e(a,t)||(a=n),a!=o&&(o=a,setCookie("lang",a,365),c(i))}}(),jQuery(function($){function thumbnail_video(e){var t=document.getElementById("canvas");t.getContext("2d").drawImage(e,0,0,e.videoWidth,e.videoHeight)}function readURL(e){if(e.files&&e.files[0]){var t=new FileReader,n=document.getElementById("photo");t.onload=function(e){$("#photo").attr("src",e.target.result),n.onload=function(){imgW=this.naturalWidth,imgH=this.naturalHeight,imgW>imgH?$("#photo").addClass("land"):$("#photo").removeClass("land")}},t.readAsDataURL(e.files[0])}}function view_image(e,t,n){var a=t?t.get(0):null,o="";let i=a.tagName.toUpperCase();if(e.files&&e.files[0]){var r=new FileReader;if(!a)return;return r.onload=function(e){o=e.target.result,"IMG"==i?t.attr("src",o):t.css("background","url("+o+") no-repeat 50% 50%/cover #e1e1e1"),a.onload=function(){imgW=this.naturalWidth,imgH=this.naturalHeight,imgW>imgH?t.addClass("land"):t.removeClass("land")}},r.readAsDataURL(e.files[0]),!0}return("hidden"==e.type||"text"==e.type)&&(o=e.value,"IMG"==i?t.attr("src",o):t.css("background","url("+o+") no-repeat 50% 50%/cover #e1e1e1"),!0)}function view_video(e,t){if(e.files&&e.files[0]){var n=new FileReader,a=t?t.get(0):null;if(!a)return;n.onload=function(e){t.attr("src",e.target.result),a.onload=function(){iframeW=this.naturalWidth,iframeH=this.naturalHeight,iframeW>iframeH?t.addClass("land"):t.removeClass("land")}},n.readAsDataURL(e.files[0])}}function view_video_thumnail(e,t){var n=e.target.files[0],a=new FileReader;a.onload=function(){var e=new Blob([a.result],{type:n.type}),o=URL.createObjectURL(e),i=document.createElement("video"),r=function(){s()&&(i.removeEventListener("timeupdate",r),i.pause())};i.addEventListener("loadeddata",function(){s()&&i.removeEventListener("timeupdate",r)});var s=function(){var e=document.createElement("canvas");e.width=i.videoWidth,e.height=i.videoHeight,e.getContext("2d").drawImage(i,0,0,i.videoWidth,i.videoHeight);var n=e.toDataURL(),a=n.length>1e5;return a&&($("#thumb1").css("background","url("+n+") no-repeat 50% 50%/cover #e1e1e1"),URL.revokeObjectURL(o)),t&&"function"==typeof t&&t(),a};i.addEventListener("timeupdate",r),i.preload="metadata",i.src=o,i.muted=!0,i.playsInline=!0,i.play()},a.readAsArrayBuffer(n)}const SERVICE_NAME="kkikda";$(".box_language").on("click",".box_current",function(){$(".box_option").toggle(),$(this).find(".arrow.up,.arrow.down").toggle()}),$(".box_language").on("click",".box_option",function(){let e=$(this).attr("data-lang");e!=window.lang&&($(".box_option").toggle(),_c(e,function(){window.location.reload()}))}),$(window).resize(function(){}),$(document).on("change","input.file-upload",function(){var e=$(this).closest(".file-select"),t=$(this)[0].files[0],n=$(this)[0].files[0].size,a=n/Math.pow(1024,2);if(t.type.match("image.*"));else if(t.type.match("video.*")){var o=100;if(a>o)alert(__("100MB를 넘는 영상은 유투브 등에 업로드하시고 소스 코드를 복사해서 붙여주세요."));else{if(window.FileReader)var i=t.name;else i=$(this).val().split("/").pop().split("\\").pop();e.find("input.file-name").val(__("파일이름")+" : "+i)}}});const upload_file=function(e,t){t=t||"";let n="";if(""!=$.trim(e.val())){$form=$('<form><input type="hidden" name="token" value="'+getCookie("token")+'"></form>'),$form.attr("enctype","multipart/form-data"),e.attr("name","file_data").after(e.clone(!0)),$form.append(e);var a=new FormData($form[0]);$.ajax({url:API_URL+"/upload/?",async:!1,processData:!1,contentType:!1,data:a,type:"POST",success:function(e){if(e&&e.success&&e.payload){let a=e.payload[0];a.url?n=a.url:alert(__("{item_name} 파일을 저장하지 못했습니다.").replace("{item_name}",t))}else{let n=e.error&&e.error.message?e.error.message:"";alert(__("{item_name} 파일을 저장하지 못했습니다.").replace("{item_name}",t)+" "+n)}},fail:function(){alert(__("{item_name} 파일을 업로드하지 못했습니다.").replace("{item_name}",t))}})}return n},APP_NAME="stube",APP_VERSION="1.00.1",APP_LOAD_TIME=(new Date).getTime();let APP_RUNMODE="live",TOKEN_DOMAIN=window.location.host,API_URL="https://api."+window.location.host.replace("www.","")+"/v1.0",SERVICE_DOMAIN="www.exbds.io";-1===window.location.host.indexOf("loc.")&&-1===window.location.host.indexOf("localhost")||(APP_RUNMODE="loc",API_URL="http://"+window.location.host+"/api/v1.0",SERVICE_DOMAIN="loc.exbds.io"),-1!==window.location.host.indexOf("dev.")&&(APP_RUNMODE="dev",API_URL="http://"+window.location.host+"/api/v1.0",SERVICE_DOMAIN="dev.exbds.io"),-1!==window.location.host.indexOf("stage.")&&(APP_RUNMODE="stage",API_URL="https://api."+window.location.host+"/v1.0",SERVICE_DOMAIN="stage.exbds.io");const LOGIN_PAGE="/login.php";$.fn.numericVal=function(){return 1*$(this).val().replace(/[^0-9.]/g,"")},$.fn.hScroll=function(e){e=e||120,$(this).bind("DOMMouseScroll mousewheel",function(t){var n=t.originalEvent,a=n.detail?n.detail*-e:n.wheelDelta,o=$(this).scrollLeft();o+=a>0?-e:e,$(this).scrollLeft(o),t.preventDefault()})};let APP_LANG=window.lang||"ko";const change_language=function(e){e&&e!==APP_LANG&&(tpl={},APP_LANG=e,$("html").attr("lang",APP_LANG),Model.user_info.userid&&add_request_item("putMyInfo/putLanguage.php",{display_language:e},function(e){}),_c(e,function(){reload()}))};$(".box_language").on("click",function(){$(".box_language .flags").toggle()}),$(".box_language [name=btn_language]").on("click",function(){let e=$(this).attr("data-lang");change_language(e)});const dprice=function(e,t){let n=t||Model.user_info&&Model.user_info.exchange_currency||"USD",a=Model.currency[n].pre_symbol,o=Model.currency[n].sub_symbol,i=Model.currency[n].exchange_price;return a+real_number_format(e*i)+o};var referrer="";let path_name=window.location.pathname,page_name="",__listener__={},__data__={},model_item=!1,session_item=model_item&&model_item.session_item||["token","user_info","user_wallet","visited_notice","hide_popup_time","user_goods"],local_item=model_item&&model_item.local_item||["hide_notice","auto_login","exchange_rate","goods","web_config","company_info","last_login_info","currency","hide_popup_time","model_item"],cookie_item=model_item&&model_item.cookie_item||["check_pin"],_no=(Math.random()+(new Date).getTime()/Math.random()+"").replace(".",""),key=getCookie("token");key?key=APP_NAME+APP_VERSION+key:(setCookie("token",_no,0,TOKEN_DOMAIN),key=APP_NAME+APP_VERSION+_no);const set_model_location=function(e,t){"session"===t&&(local_item=remove_array_by_value(local_item,e),void 0===session_item[e]&&session_item.push(e)),"local"===t&&(session_item=remove_array_by_value(session_item,e),void 0===local_item[e]&&local_item.push(e))},clone=function(e){return JSON.parse(JSON.stringify(e))},addChangeListener=function(e,t,n){const a=t;__listener__[e]?__listener__[e][a]=n:(__listener__[e]={},__listener__[e][a]=n)},rander=function(e,t,n,a){for(i in t){let o=t[i],r=null,s=n&&n[i]?n[i]:"";(o!==s||a)&&(typeof o==typeof{}?rander(e+"."+i,o,s,a):($('[data-bind="'+e+"."+i+'"]').each(function(){var e=this.tagName,t=(e=e.toUpperCase(),$(this).attr("data-format"));switch(t){case"table":const e=o,n=$(this),a=n.find("[name=empty]"),i=n.find("[name=search]");if(i.hide().addClass("hide"),a.hide().addClass("hide"),!e||e.length<1)a.show().removeClass("hide"),n.children().not("[name=tpl],[name=search],[name=empty]").remove();else{let t=[],a=$("<div></div>").append(n.find("[name=tpl]").clone().attr("name","").removeClass("hide"));for(let n in e){let o=e[n],i=a.clone();for(let e in o){let t=i.find('[data-bind="row.'+e+'"]'),n=o[e],a=t.attr("data-format"),r=t.attr("data-decimals");switch(a){case"attr":t.attr("data-"+e,n);break;case"comma":t.text(real_number_format(n,r));break;case"date":t.each(function(){let e=$(this).attr("data-date_format")||"";$(this).text(e?date(e,n):n)});break;case"add-class":t.addClass(n);break;case"number":t.text((n+"").replace(/[^0-9.-]/g,""));break;default:t.each(function(){const e=this.tagName?this.tagName.toUpperCase():"";switch(e){case"A":t.attr("href",n);break;default:"html"==a?t.html(n):t.text(n)}})}}t[n]=i.html()}n.children().not("[name=tpl],[name=search],[name=empty]").remove(),n.append(t.join(""))}break;case"comma":r=real_number_format(o);break;case"number":r=1*(o+"").replace(/[^0-9.]/g,"");break;case"add-class":return void $(this).addClass(o);default:r=o}switch(e){case"INPUT":let t=($(this).attr("type")+"").toUpperCase();switch(t){case"CHECKBOX":let e=o==$(this).val();(e&&!$(this).is(":checked")||!e&&$(this).is(":checked"))&&$(this).trigger("click");break;case"RADIO":r==$(this).val()&&$(this).trigger("click");break;case"NUMBER":case"HIDDEN":$(this).val(r);break;default:r=r&&r.toNumber()==r&&"number"==(typeof r).toLowerCase()&&!(r+"").match(/[^0-9.]/)?real_number_format(r):r,$(this).val(r)}break;case"TEXTAREA":case"SELECT":$(this).val(r);break;case"IMG":case"IFRAME":$(this).attr("src",r);break;default:"userid"!=i&&(r=r&&r.toNumber()==r&&"number"==(typeof r).toLowerCase()&&!(r+"").match(/[^0-9.]/)?real_number_format(r):r),$(this).html(r)}}),$('[data-display^="'+e+"."+i+'"]').each(function(){let e=$(this).attr("data-display");e=e.split("="),o==e[1]?$(this).removeClass("hide").attr("style",""):$(this).addClass("hide").attr("style","")})))}};"live"!=APP_RUNMODE&&(window.rander=rander);const force_rander=function(e,t){rander(e,t,t,!0)};"live"!=APP_RUNMODE&&(window.force_rander=force_rander);const _get_Model_value=function(e,t){let n=e[t]?JSON.parse(Decrypt(e[t],key,256)):"";try{session_item.indexOf(t)>-1&&sessionStorage.getItem(t)&&(n=JSON.parse(Decrypt(sessionStorage.getItem(t),key,256))),local_item.indexOf(t)>-1&&(n=JSON.parse(Decrypt(localStorage.getItem(t),key,256))),cookie_item.indexOf(t)>-1&&(n=getCookie(t))}catch(e){n=""}return n},handler={get:function(e,t){return _get_Model_value(e,t)},set:function(e,t,n){let a=_get_Model_value(e,t);try{session_item.indexOf(t)>-1?sessionStorage.setItem(t,Encrypt(JSON.stringify(n),key,256)):local_item.indexOf(t)>-1?localStorage.setItem(t,Encrypt(JSON.stringify(n),key,256)):cookie_item.indexOf(t)>-1?setCookie(t,n):e[t]=Encrypt(JSON.stringify(n),key,256),JSON.stringify(n)!==JSON.stringify(a)&&rander&&rander(t,n,a)}catch(e){}return!0}};let Model={};try{Model=new Proxy(__data__,handler)}catch(e){let t=clone(Model);const n=function(){for(i in Model){let e=Model[i],n=t[i];JSON.stringify(e)!==JSON.stringify(n)&&rander&&rander(i,e,n)}t=clone(Model),setTimeout(function(){n()},100)};n()}"live"!=APP_RUNMODE&&(window.Model=Model),Model.check_SMS_for_bank=!1,Model.currency={KRW:{pre_symbol:"",sub_symbol:__("원"),exchange_price:1,is_blockchain:!1,is_virtual_currency:!1,symbol_image:"",name:"대한민국 원"},GWS:{pre_symbol:"",sub_symbol:" GWS",exchange_price:5e4,is_blockchain:!0,is_virtual_currency:!0,symbol_image:"",name:"Goldswings"},BDC:{pre_symbol:"",sub_symbol:" BDC",exchange_price:1e6,is_blockchain:!1,is_virtual_currency:!0,symbol_image:"",name:"BDS Coin"},HTP:{pre_symbol:"",sub_symbol:" HTP",exchange_price:10,is_blockchain:!1,is_virtual_currency:!0,symbol_image:"",name:"Heart Point"},HTC:{pre_symbol:"",sub_symbol:" HTC",exchange_price:1e4,is_blockchain:!1,is_virtual_currency:!0,symbol_image:"",name:"Heart Coin"}},Model.exchange_rate={base_currency:"KRW",base_symbol:"₩",KRW:Model.currency.KRW.exchange_price,GWS:Model.currency.GWS.exchange_price,HTC:Model.currency.HTC.exchange_price,HTP:Model.currency.HTP.exchange_price,BDC:Model.currency.BDC.exchange_price},Model.company_info={bank_name:"",bank_address:"",depositor:"",fee_address:{BDC:"",GWS:"",HTC:"",KRW:""}},Model.goods={product:[]},Model.web_config={};var items=[],callbacks=[],timeoutkeys=[],request_warkable=!0;const request_api=function(){if(setTimeout(request_api,300),request_warkable&&items&&items.length>0){request_warkable=!1;var e=items,t=callbacks;items=[],callbacks=[];let n={item:e};n.token=getCookie("token"),$.post(API_URL+"/request/?",n,function(e){for(var n in request_warkable=!0,e.payload){const a=e.payload[n],o=JSON.parse(a.data);o.error&&o.error.code,t[n]&&t[n](o,n)}},"json")}};request_api();const add_request_item=function(e,t,n,a,o,i){var r=path_name;o=o||r;if(a>0&&o!==r)return!1;Model.token&&(t.token=Model.token);const s={method:e,params:t};if(!i)for(var l in items)if(JSON.stringify(items[l])==JSON.stringify(s))return;items.push(s);let c=items.length-1;if(callbacks[c]=n,a>0&&o===r){let o=setTimeout(function(){add_request_item(e,t,n,a,r)},a);timeoutkeys[c]=o}},genPagingStube=function(e,t,n,a){for(e=e?1*e:0,t=t?1*t:1,n=n?1*n:10,a=a?1*a:10,max_pages=e?Math.ceil(e/n):1,r="",r+=e>0&&t>1?'<span><a href="'+setUrlParamValue("page",t-1,window.location.search)+'"><img src="/@resource/images/icon/ico_arr_prev.png" alt=""></a></span>':'<span><img src="/@resource/images/icon/ico_arr_prev.png" alt="" class="inactive"></span>',batch=Math.ceil(t/a),end=batch*a,end,end>max_pages&&(end=max_pages),start=end-a+1,start=start<1?1:start,i=start;i<=end;i++)i==t?r+='<span class="num active"><a href="'+setUrlParamValue("page",i,window.location.search)+'">'+i+"</a></span>":r+='<span class="num"><a href="'+setUrlParamValue("page",i,window.location.search)+'">'+i+"</a></span>";return e>0&&t<max_pages?r+='<span><a href="'+setUrlParamValue("page",t+1,window.location.search)+'"><img src="/@resource/images/icon/ico_arr_next.png" alt=""></a></span>':r+='<span><img src="/@resource/images/icon/ico_arr_next.png" alt="" class="inactive"></span>',r},display_remain_time=(e,t,n)=>{let a=e-Math.floor((new Date).getTime()/1e3),o=a<0?0:Math.floor(a/60),i=a<0?0:a%60;$(t).text(sprintf("%02d",o)),$(n).text(sprintf("%02d",i)),a>=0&&setTimeout(function(){display_remain_time(e,t,n)},500)},load_file=e=>{if($("#"+md5(e)).length>0)return!1;e.indexOf(".js")>0&&$("body").append('<script type="text/javascript" src="'+e+'" id="'+md5(e)+'"></script>'),e.indexOf(".css")>0&&$("head").append('<link rel="stylesheet" type="text/css" href="'+e+'" id="'+md5(e)+'">')},gen_qrcode=(e,t)=>{$(e).empty().qrcode({width:$(e).width(),height:$(e).width(),text:t})},CopyUrlToClipboard=e=>{var t=document.getElementById("ShareUrl");t.value=window.document.location.href,t.select(),document.execCommand("copy"),t.blur()};let sound_obj={};const sound_file={};for(i in sound_file){let e=new Audio;e.src=sound_file[i],sound_obj[i]=e}const sound_play=e=>{"N"!==Model.user_info.sound_onoff&&sound_obj[e]},get_video_url=function(e){e=$.trim(e);let t="";return e.indexOf("//youtu.be/")>-1?t="https://www.youtube.com/embed/"+e.replace(/.*\/\/youtu.be\//,"").replace(/\&.*/,""):e.indexOf("//youtube.com/watch?v=")>-1?t="https://www.youtube.com/embed/"+e.replace(/.*\/\/youtube.com\/watch\?v=/,"").replace(/\&.*/,""):e.indexOf("//m.youtube.com/watch?v=")>-1?t="https://www.youtube.com/embed/"+e.replace(/.*\/\/m.youtube.com\/watch\?v=/,"").replace(/\&.*/,""):e.indexOf("//www.youtube.com/watch?v=")>-1?t="https://www.youtube.com/embed/"+e.replace(/.*\/\/www.youtube.com\/watch\?v=/,"").replace(/\&.*/,""):e.indexOf("<iframe ")>-1?(t=e.match(/src="(.[^"]*)"/),t=t?t[1]:e.match(/src='(.[^']*)'/)?e.match(/src='(.[^']*)'/)[1]:"",t=t||(e.match(/src=(.[^ ]*) /)?e.match(/src=(.[^ ]*) /)[1]:"")):e.indexOf("http://")>-1||e.indexOf("https://"),t},get_video_img=function(e){let t=[];if(e.indexOf("youtube")>-1){let n="";e.indexOf("//www.youtube.com/embed/")>-1&&(n=e.replace("https://www.youtube.com/embed/",""),n&&n.indexOf("?")>-1&&(n=n.substr(0,n.indexOf("?")))),e.indexOf("//www.youtube.com/watch")>-1&&(n=e.match(/youtube.com\/watch\?v=(.[^&]*)/),n=n?n[1]:""),$.get({url:"https://www.youtube.com/oembed?format=xml&url=https%3A%2F%2Fwww.youtube.com%2Fwatch%3Fv%3D"+n,async:!1,success:function(e){t.push($("thumbnail_url",t).text())}})}return t},check_userinfo=function(){return Model.user_info&&Model.user_info.userno?Model.user_info&&Model.user_info.userno&&!Model.user_info.nickname?(alert(__("회원정보를 등록 해주세요")),closeModal(),$('.btn-user-menu[name="btn-userinfo"]').click(),!1):void 0:(alert(__("로그인 해주세요")),closeModal(),!1)},get_lv_amount=function(e){let t="1";switch(e){case 1:t=1;break;case 2:t=10;break;case 3:t=20;break;case 4:t=50;break;case 5:t=100;break;case 6:t=200;break;case 7:t=500;break;case 8:t=1e3;break;case 9:t=2e3;break;default:t=1}return t},get_coin_icon_class=function(e){let t="coin-1";switch(e*=1,e){case 1:t="coin-1";break;case 10:t="coin-10";break;case 20:t="coin-20";break;case 50:t="coin-50";break;case 100:t="coin-100";break;case 200:t="coin-200";break;case 500:t="coin-500";break;case 1e3:t="coin-1000";break;case 2e3:t="coin-5000";break;default:t="coin-1"}return t},use_http=function(){};let scroll_searching=!1,scroll_end=!1;const tpl_video_item='<li><a href="/views.php?video_idx={video_idx}"><div class="img" style="background-image:url({video_img});background-size:cover" alt="{title}"></div></a><div class="explan"><a href="user-main.php?userno={video_userno}"><span class="picture" style="background-image:url({user_profile_img})"></span></a><p class="txt"><a href="/views.php?video_idx={video_idx}">{title}</a></p><div class="pay_date"><p class="pay"><a href="user-main.php?userno={video_userno}"><span class="name">{nickname}</span></a><span class="ico_pay"></span><span>{view_cnt}</span></p><p class="date">{reg_date}</p></div></div></li>',gen_video_htmnl=function(e){if(e&&e.payload){let t=[],n=e.payload.data||[];for(n.length<1&&(scroll_end=!0),i=0;i<n.length;i++){let e=n[i];t[i]=tpl_video_item.replace(/\{video_img\}/g,e.file_name||"about:blank").replace(/\{user_profile_img\}/g,e.profile_img||"/@resource/images/common/basic_profile.png").replace(/\{nickname\}/g,e.nickname||"").replace(/\{title\}/g,e.title||"").replace(/\{reg_date\}/g,e.reg_date.substr(1,10)||"").replace(/\{video_idx\}/g,e.idx||"").replace(/\{video_userno\}/g,e.userno||"").replace(/\{view_cnt\}/g,real_number_format(e.view_cnt)||"")}$(".play-list ul.item-grid").append(t.join(""))}scroll_searching=!1},add_event_click_left_menu_tab=function(){$("#left_menu .inTabs li").on("click",function(){let e=$(this).attr("data-target");$(this).addClass("active").siblings().removeClass("active"),$(e).show().siblings(".tab_con").hide()})},check_login=function(){Model.user_info&&(Model.user_info.userid||Model.user_info.userno)||(window.location.href=LOGIN_PAGE)},get_new_message=function(e){let t=$("[name=msg_box]:last").attr("data-idx");add_request_item("getChatMessage",{token:getCookie("token"),last_msg_idx:t,target_idx:window.chat_target_idx},function(e){if(e&&e.success&&e.payload&&!e.error){let t=e.payload,n=[],a=0,o=!1;if(t.length>0){for(a in t){let e=t[a];$("li[name=msg_box][data-idx="+e.idx+"]").length>0||(n[a]=get_html(e),a++)}$(".comment-wrap").scrollTop()+$(".comment-wrap").innerHeight()>$(".comment-wrap")[0].scrollHeight-20&&(o=!0),$("[name=comment-list]").append(n.join("")),o&&set_scroll_bottom()}}}),e>0&&setTimeout(function(){get_new_message(e)},e)},tpl_suport='<div class="realtime_spon" name="msg_box" data-idx="{idx}">    {html_delete_icon}    <p class="pay_meney">{amount_str}<img src="/@resource/images/icon/ico_smart_pay.png" alt=""></p><p class="txt"><a href="/user-main.php?userno={userno}">{nickname}</a> 님이 {amount_str} PAY를 조공하였습니다</p></div>',tpl_chat='<dl name="msg_box" data-idx="{idx}">    {html_delete_icon}    <dt><a href="/user-main.php?userno={userno}"><img src="{profile_img}" alt="{nickname}"></a></dt><dd><p class="name"><a href="/user-main.php?userno={userno}">{nickname}</a> <img src="/@resource/images/icon/ico_fan1.png" alt=""></p><p class="txt">{comment}</p></dd></dl>',get_html=function(e){let t=e.amount>0?tpl_suport:tpl_chat;return t.replace(/\{idx\}/g,e.idx).replace(/\{profile_img\}/g,e.profile_img||"/@resource/images/common/basic_profile.png").replace(/\{nickname\}/g,e.nickname||e.name).replace(/\{amount\}/g,e.amount).replace(/\{userno\}/g,e.userno).replace(/\{amount_str\}/g,number_format(e.amount)).replace(/\{coinname\}/g,Model.currency&&Model.currency[e.symbol]&&Model.currency[e.symbol].name).replace(/\{coin_icon\}/g,get_coin_icon_class(e.amount)).replace(/\{comment\}/g,nl2br(htmlspecialchars(e.comment))).replace(/\{supported-user\}/g,e.amount>0?"supported-user":"").replace(/\{hide_spon\}/g,e.amount>0?"":"hide").replace(/\{html_delete_icon\}/g,e.userno==Model.user_info.userno?'<a href="#" class="chat_close"><img src="/@resource/images/icon/ico_close2.png" alt="" data-idx="'+e.idx+'" class="btn btn-delete-msg"></a>':"")},get_old_message=function(){if(scroll_searching||scroll_end)return!1;scroll_searching=!0;let e=$("[name=msg_box]:first").attr("data-idx");add_request_item("getChatMessage",{token:getCookie("token"),prev_msg_idx:e,target_idx:window.chat_target_idx},function(t){if(scroll_searching=!1,t.payload&&t.payload.length||(scroll_end=!0,$("[name=comment-list]").prepend('<li class="center">'+__("더이상 내용이 없습니다.")+"</li>")),t&&t.success&&!t.error){let n=t.payload,a=[],o=0;for(o in n){let e=n[o];a[o]=get_html(e),o++}$("[name=comment-list]").prepend(a.join("")),$(".comment-wrap").scrollTop($("li[data-idx="+e+"]").position().top)}})},set_scroll_bottom=function(){$(".comment-wrap:visible").scrollTop($("[name=comment-list]:visible").height())},set_position_chatbox=function(){$(".right_menu").is(":visible")?($(".mobile_cheat_box").hide(),set_scroll_bottom()):($(".mobile_cheat_box").show(),set_scroll_bottom())},fn_index=function(){API.getBBSList("notice",1,5,e=>{e.success&&($("#notice--list").empty(),e.payload.data.map(e=>{const t=$("<li>"),n=new Date(e.regdate);t.append(`<a href="notice_detail.html" class="list--text">${e.subject}</a>`),t.append(`<span class="list--date list--right">${n.getFullYear()}.${n.getMonth()}.${n.getDate()}</sp>`),t.appendTo("#notice--list")}))})},fn_check_pin=function(){window.keypress_support=!1,$("#check_pin form").each(function(){$(this).reset&&$(this).reset()}),$("#check_pin input[type=password]").on("keypress keyup",function(e){if("keypress"==e.type&&(window.keypress_support=!0),window.keypress_support&&"keyup"==e.type)return!1;let t=get_keycode(e),n=get_str_by_keycode(t);if("keyup"==e.type&&(n=$(this).val()),"8"==t||"46"==t||"9"==t||"13"==t||"16"==t||"17"==t||"18"==t||"19"==t||"20"==t);else{if(n.match(/[^0-9]/))return!1;$(this).val(n),$(this).next("input[type=password]").select(),$("#check_pin [name=userpw]").val($("#check_pin [name=userpw1]").val()+""+$("#check_pin [name=userpw2]").val()+$("#check_pin [name=userpw3]").val()+$("#check_pin [name=userpw4]").val()+$("#check_pin [name=userpw5]").val()+$("#check_pin [name=userpw6]").val())}return!1}).on("keydown",function(e){let t=get_keycode(e);if("8"==t||"46"==t)return $(this).prev("input[type=password]").select(),$(this).val(""),$("#check_pin [name=userpw]").val($("#check_pin [name=userpw1]").val()+""+$("#check_pin [name=userpw2]").val()+$("#check_pin [name=userpw3]").val()+$("#check_pin [name=userpw4]").val()+$("#check_pin [name=userpw5]").val()+$("#check_pin [name=userpw6]").val()),!1;13==t&&$(".btn_group .btn:eq(0)").trigger("click")}).on("click",function(){$(this).select()});const e=function(e){$("#check_pin .error_txt").text(e)};$("#check_pin [name=btn-checkpin]").on("click",function(){let t=$("#check_pin [name=userpw]"),n=t.val();return n?(add_request_item("checkPin",{pin:n},function(t){if(t&&t.success&&t.payload){Model.check_pin=time();let e=getURLParameter("ret_url");window.location.href=e?base64_decode(e):"/user-info.php"}else{let n=t.error&&t.error.message?t.error.message.replace("거래보안번호","핀번호"):__("핀번호가 올바른지 확인해주세요.");e(n)}}),!1):(e(__("핀번호를 입력해주세요.")),t.focus(),!1)})},fn_login=function(){window.keypress_support=!1,$("#login form").each(function(){$(this).reset&&$(this).reset()}),$("#login [name=userid]").get(0).focus(),$("#login input[type=password]").on("keypress keyup",function(e){if("keypress"==e.type&&(window.keypress_support=!0),window.keypress_support&&"keyup"==e.type)return!1;let t=get_keycode(e),n=get_str_by_keycode(t);if("keyup"==e.type&&(n=$(this).val()),"8"==t||"46"==t||"9"==t||"13"==t||"16"==t||"17"==t||"18"==t||"19"==t||"20"==t);else{if(n.match(/[^0-9]/))return!1;$(this).val(n),$(this).next("input[type=password]").select(),$("#login [name=userpw]").val($("#login [name=userpw1]").val()+""+$("#login [name=userpw2]").val()+$("#login [name=userpw3]").val()+$("#login [name=userpw4]").val()+$("#login [name=userpw5]").val()+$("#login [name=userpw6]").val())}return!1}).on("keydown",function(e){let t=get_keycode(e);if("8"==t||"46"==t)return $(this).prev("input[type=password]").select(),$(this).val(""),$("#login [name=userpw]").val($("#login [name=userpw1]").val()+""+$("#login [name=userpw2]").val()+$("#login [name=userpw3]").val()+$("#login [name=userpw4]").val()+$("#login [name=userpw5]").val()+$("#login [name=userpw6]").val()),!1;13==t&&$(".btn_group .btn:eq(0)").trigger("click")}).on("click",function(){$(this).select()});const e=function(e){$("#login .error_txt").text(e)};$("#login [name=btn-login]").on("click",function(){let t=$("#login [name=userid]"),n=t.val(),a=$("#login [name=userpw]"),o=a.val();$("#login [name=auto_login]").is(":checked");if(!n)return e(__("ID(전화번호)를 입력해주세요.")),t.focus(),!1;if(n=n.replace(/^0/,""),n="mobile82"+n,!o)return e(__("핀번호를 입력해주세요.")),a.focus(),!1;$("#login [name=userpw]").val(o),e(""),Model.user_info={};var i=new UAParser;i.setUA(window.navigator.userAgent);var r=i.getOS(),s=i.getDevice();return add_request_item("login",{userid:n,userpw:o,mobile_country_code:"KR",uuid:s?s.vendor+"-"+s.model+"-"+r.name+"-"+r.version:"",os:r?r.name+"-"+r.version:"",fcm_tokenid:getCookie("fcm_token")},function(t){if(t&&t.success&&t.payload){setCookie("token",t.payload.token),Model.token=t.payload.token,Model.last_login_info={userid:n};let e={userid:n};Model.user_info=e,get_user_wallet(),get_user_info();let a=getURLParameter("ret_url");a=a?$.trim(base64_decode(a)):"/",a=setURLParameter("t",time(),a),window.location.href=a}else{let n=t.error&&t.error.message?t.error.message:__("로그인 정보가 올바른지 확인해주세요.");e(n)}}),!1})},fn_logout=function(){$.post(API_URL+"/logout/",{token:getCookie("token")},function(e){Model.user_info={},Model.auto_login=!1,Model.visited_notice=!1,setCookie("token","",-1),setCookie("token","",-1,"."+TOKEN_DOMAIN),window.location.href="/"})};window.logout=fn_logout;const fn_join=function(){$.get("/template/stube/uselaw_ko.txt",function(e){$("#join [name=uselaw]").text(e)}),$.get("/template/stube/privacy_ko.txt",function(e){$("#join [name=privacy]").text(e)}),$("[name=btn-agree]").on("click",function(){let e=$("#ck1"),t=$("#ck2");return e.is(":checked")?t.is(":checked")?($("#agree").hide(),void $("#write").show()):(alert("개인 정보 이용 약관을 확인 후  동의해주세요."),t.focus(),!1):(alert("이용 약관을 확인 후 동의해주세요."),e.focus(),!1)}),$("#join form").each(function(){$(this).reset&&$(this).reset()});let e=0,t=!1,n=!1,a="",o="";$("[name=btn-request]").on("click",function(){let n=($("[name=mobile_number1]").val()+"").trim(),r=($("[name=mobile_number2]").val()+"").trim(),s=($("[name=mobile_number3]").val()+"").trim(),l=n+r+s,c="82",m="KR";return l&&n&&r&&s?(l=c+l.replace(/^0/,""),t?(alert(__("인증번호를 보내는중입니다.")+__("잠시만 기다려주세요.")),!1):($("[name=mobile_number1],[name=mobile_number2],[name=mobile_number3]").attr("disabled",!0),a=l.replace(/[^0-9]/g,""),confirmed_mobile_calling_code=c,o=m,t=!0,void $.post(API_URL+"/checkJoin/",{media:"mobile",ids:l},function(n){let a=!1;if(n&&n.payload)for(i in n.payload)n.payload[i].id==l&&"joined"==n.payload[i].status&&(a=!0);a?alert(__("이미 가입하셨습니다.")+" "+__("로그인 해주세요.")):window.send_authmsg(l,function(n){if(t=!1,n&&n.success)e=Math.floor((new Date).getTime()/1e3)+3600,display_remain_time(e,"#form_phone [name=min]","#form_phone [name=sec]"),$("#form_phone [name=min]").parent().removeClass("hide"),$("[name=confirm_number]").focus(),alert(__("인증번호를 발송했습니다."));else{let e=n.error&&n.error.message?n.error.message:"";alert(__("인증메시지를 보내지 못했습니다.")+" "+e),$("#form_phone [name=min]").parent().addClass("hide"),$("[name=mobile_number1],[name=mobile_number2],[name=mobile_number3]").attr("disabled",!1)}})}))):(alert(__("핸드폰 번호를 입력해주세요")),!1)}),$("[name=btn-confirm]").on("click",function(){let t=$("[name=confirm_number]").val();return 0==e?(alert(__("인증 요청을 해주세요.")),!1):e-Math.floor((new Date).getTime()/1e3)<=0?($("[name=mobile_number1],[name=mobile_number2],[name=mobile_number3]").attr("disabled",!1),alert(__("유효시간이 지났습니다. 다시 인증 요청을 해주세요.")),!1):t?void window.check_authcode(t,function(e){if(e&&e.success)n=!0,$("[name=confirm_number]").attr("disabled",!0),alert(__("휴대폰번호가 인증되었습니다."));else{$("[name=confirm_number]").attr("disabled",!1);let t=e.error&&e.error.message?e.error.message:"";alert(__("올바른 인증번호를 입력해주세요.")+" "+t)}}):(alert(__("인증번호를 입력해주세요.")),!1)}),$("[name=btn-join]").on("click",function(){let e=$("[name=pin]").val();if(!e)return alert(__("핀번호를 입력해주세요.")),!1;var t=new UAParser;t.setUA(window.navigator.userAgent);var n=t.getOS(),i=t.getDevice();const r={userid:"mobile"+a,userpw:$("[name=pin]").val(),name:$("[name=username]").val(),mobile:a,mobile_country_code:o,mobile_calling_code:confirmed_mobile_calling_code,pushkey:getCookie("fcm_token"),os:n?n.name+"-"+n.version:"",uuid:i?i.vendor+"-"+i.model+"-"+n.name+"-"+n.version:""};$.post(API_URL+"/join/",r,function(e){if(e&&e.success)alert(__("회원가입을 완료했습니다."));else{let t=e.error&&e.error.message?e.error.message:"";alert(__("회원가입을 하지 못했습니다.")+" "+t)}},"json")})},fn_transaction=function(){check_login();let e=$("[name=wallet_address]").val(),t=$("[name=rows]").val(),n=$("[name=cnt_total]").val();$(".paging").on("click","a",function(){var a=$(this).attr("href"),o=a.match(/page=(.[^&]*)/);o=o&&o[1]?o[1]:"";let r='<tr class="{row_class}"><td>{reg_date}</td><td>{amount} PAY</td><td>{txn_type_str}</td><td>{relative_info}</td><td>{status_str}</td></tr>';return o&&add_request_item("/getTransactionList/",{symbol:"SPAY",address:e,page:o,rows:t},function(e){if(e&&e.success){
let a=[];for(i in e.payload){let t=e.payload[i];t.cnt_total&&(n=t.cnt_total),a.push(r.replace("{row_class}","out"==t.direction?"deposit":"").replace("{reg_date}",date("m-d H:i",t.regtime)).replace("{amount}","out"==t.direction?"-"+t.amount:"+"+t.amount).replace("{txn_type_str}",t.txn_type_str||"").replace("{relative_info}",t.relative_info||"").replace("{status_str}",t.status_str||"")),$(".pay_trade tbody").html(a.join(""))}$(".paging").html(genPagingStube(n,o,t))}}),!1})},fn_message=function(){check_login(),$("[name=btn-gotolist]").on("click",function(){$("[name=box_view],[name=box_list]").toggleClass("hide"),$("[name=box_view] [name=message]").html("")}),$("[name=box_list]").on("click","[name=row_message]",function(){let e=$(this).attr("data-idx"),t=$(this).attr("data-message"),n=$(this).attr("data-sender"),a=$(this).attr("data-date");$("[name=box_view] [name=message]").html(t),$("[name=box_view] [name=sender]").html(n),$("[name=box_view] [name=date]").html(a),$("[name=box_view],[name=box_list]").toggleClass("hide"),e&&$.post(API_URL+"/putMessage/msg_read.php",{idx:e,token:getCookie("token")},function(e){}),$(this).addClass("fc-gray1")}),$('#message [name="message"]').on("click",function(){$(this).find("[name=tiny],[name=full]").toggleClass("hide");let e=$(this).attr("data-read_date");if(!e){let e=$(this).attr("data-idx");const t=$(this).closest("tr");$.post(API_URL+"/putMessage/msg_read.php",{token:getCookie("token"),idx:e},function(e){e&&e.success&&t.find('[name="read_date"]').removeClass("unread").html(date("m-d H:i"))})}}),$('#message [name="message"] [name="full"] a').on("click",function(e){e.stopPropagation()}),$("#message #check_all").on("click",function(){let e=$(this).is(":checked");$('#message [name="check_idx"]').each(function(){this.checked=e})}),$('#message [name="btn-save"]').on("click",function(){let e=[];return $('#message [name="check_idx"]:checked').each(function(){e.push($(this).val())}),$.post(API_URL+"/putMessage/msg_keep.php",{token:getCookie("token"),idxs:e.join(",")},function(e){e&&e.success&&(alert("메시지를 보관했습니다."),setTimeout(function(){window.location.reload()},500))}),!1}),$('#message [name="btn-cancel"]').on("click",function(){let e=[];return $('#message [name="check_idx"]:checked').each(function(){e.push($(this).val())}),$.post(API_URL+"/putMessage/msg_keep.php",{token:getCookie("token"),idxs:e.join(","),action:"del"},function(e){e&&e.success&&(alert("메시지 보관을 취소했습니다."),setTimeout(function(){window.location.reload()},500))}),!1}),$('#message [name="btn-delete"]').on("click",function(){let e=[];$('#message [name="check_idx"]:checked').each(function(){e.push($(this).val())});let t=confirm("{cnt}개의 메시지를 삭제하시겠습니까?".replace("{cnt}",e.length));return t&&$.post(API_URL+"/putMessage/msg_delete.php",{token:getCookie("token"),idxs:e.join(","),action:"del"},function(e){e&&e.success&&(alert("메시지를 삭제했습니다."),setTimeout(function(){window.location.reload()},500))}),!1})},fn_write_msg=function(){check_login();var e=new cheditor;e.templateFile="template-simple.xml",e.inputForm="contents",e.config.editorHeight="300px",e.config.editorWidth="100%",e.config.imgMaxWidth=800,e.config.useFullScreen=!1,e.run(),$('#write_msg [name="btn-write_msg"]').on("click",function(){let t=$("#write_msg [name=recever_userno]").val(),n=e.outputBodyHTML();$.post(API_URL+"/putMessage/msg_save.php",{token:getCookie("token"),recever_userno:t,message:n,service_name:SERVICE_NAME},function(e){if(e&&e.success)alert(__("메시지를 보냈습니다.")),closeModal();else{let t=e.error&&e.error.message?e.error.message:"";alert(__("메시지를 보내지 못했습니다.")+" "+t)}},"json")})},fn_upload_type=function(){check_login()},fn_photo_upload=function(){check_login(),$("[name=photo-download]").on("click",function(){let e=$("#fileUrl"),t=e.val();if(!t)return alert(__("URL을 입력해주세요.")),!1;for(i=1;i<=4;i++)if(!$("#image"+i).val()&&!$("#image"+i+"_url").val())return $("#image"+i+"_url").val(t),$("#thumb"+i).css("background","url("+t+") 50% 50% / cover no-repeat #e1e1e1").siblings(".btn-delete").show(),void e.val("");alert(__("추가할 공간이 없습니다.")+" "+__("기존 사진을 삭제하시고 추가해주세요."))}),$(".modal").on("click",".video-thumb",function(){$($(this).attr("data-target")).click()}),$(".modal").on("change","input[name^=pre_img]",function(){view_image(this,$($(this).attr("data-target")),"arasajin")&&$(this).siblings(".btn-delete").show()}),$(".modal").on("click",".btn-delete",function(){$(this).siblings(".video-thumb").css("background",""),$(this).siblings("input").val(""),$(this).hide()}),$(".modal").on("click",'[name="btn-upload-video"]',function(){$("#video_file").val(),$("#video_idx").val(),$("#htmlcode").val();let e=$("#title").val(),t=$("#cate_idx").val(),n=$("#image1").val(),a=$("#image2").val(),o=$("#image3").val(),i=$("#image4").val(),r=$("#image1_url").val(),s=$("#image2_url").val(),l=$("#image3_url").val(),c=$("#image4_url").val();if(!e)return alert(__("사진 제목을 선택해주세요.")),!1;if(!t)return alert(__("사진 종류를 선택해주세요.")),!1;if(!(n||a||o||i||r||s||l||c))return alert(__("사진을 선택해주세요.")),!1;var m=$('[name="form-video-upload"]');m.attr("enctype","multipart/form-data");var d=new FormData(m[0]);d.append("token",getCookie("token")),$('[name="btn-upload-video"]').attr("disabled",!0).text(__("업로드중입니다.")),$.ajax({url:API_URL+"/putMyInfo/video_upload.php",processData:!1,contentType:!1,data:d,type:"POST",cache:!1,timeout:9e5,success:function(e){if($('[name="btn-upload-video"]').attr("disabled",!1).text(__("사진 업로드")),e&&e.success)confirm(__("등록했습니다.")+" "+__("사진 목록으로 이동하시겠습니까?"))?window.location.href.indexOf("user-main.php")>-1?(closeModal(),window.location.reload()):window.location.href="/user-main.php?userno="+Model.user_info.userno+"#recent":(closeModal(),window.location.reload());else{let t=e.error&&e.error.message?e.error.message:"";alert(__("등록하지 못했습니다.")+" "+t)}},fail:function(){alert(__("등록하지 못했습니다."))}})})},fn_photo_event=function(){check_login(),$(".box-qr, .box-qrscan").on("click",function(){window.AraApp&&window.AraApp.qrscanner&&"function"==typeof window.AraApp.qrscanner?window.AraApp.qrscanner():alert(__("BDS지갑 앱을 이용해주세요."))}),window.set_qr_code||(window.set_qr_code=function(e){$("#qrcode").val(e)}),$("[name=photo-download]").on("click",function(){let e=$("#fileUrl"),t=e.val();if(!t)return alert(__("URL을 입력해주세요.")),!1;for(t.match(/\.jpg|\.gif|\.png|\.jpeg/)||alert(__("이미지 파일의 URL을 입력해주세요.")),i=1;i<=4;i++)if(!$("#image"+i).val()&&!$("#image"+i+"_url").val())return $("#image"+i+"_url").val(t),$("#thumb"+i).css("background","url("+t+") 50% 50% / cover no-repeat #e1e1e1").siblings(".btn-delete").show(),void e.val("");alert(__("추가할 공간이 없습니다.")+" "+__("기존 사진을 삭제하시고 추가해주세요."))}),$(".modal").on("click",".video-thumb",function(){$($(this).attr("data-target")).click()}),$(".modal").on("change","input[name^=pre_img]",function(){view_image(this,$($(this).attr("data-target")),"arasajin")&&$(this).siblings(".btn-delete").show()}),$(".modal").on("click",".btn-delete",function(){$(this).siblings(".video-thumb").css("background",""),$(this).siblings("input").val(""),$(this).hide()}),$(".modal").on("click",'[name="btn-upload-video"]',function(){$("#video_file").val(),$("#video_idx").val(),$("#htmlcode").val();let e=$("#title").val(),t=$("#cate_idx").val(),n=$("#image1").val(),a=$("#image2").val(),o=$("#image3").val(),i=$("#image4").val(),r=$("#image1_url").val(),s=$("#image2_url").val(),l=$("#image3_url").val(),c=$("#image4_url").val(),m=$("#qrcode").val();if(!e)return alert(__("사진 제목을 선택해주세요.")),!1;if(!t)return alert(__("사진 종류를 선택해주세요.")),!1;if(!m)return alert(__("QR 코드를 스캔해주세요.")),!1;if(!(n||a||o||i||r||s||l||c))return alert(__("사진을 선택해주세요.")),!1;var d=$('[name="form-video-upload"]');d.attr("enctype","multipart/form-data");var _=new FormData(d[0]);_.append("token",getCookie("token")),$('[name="btn-upload-video"]').attr("disabled",!0).text(__("업로드중입니다.")),$.ajax({url:API_URL+"/putMyInfo/video_upload.php",processData:!1,contentType:!1,data:_,type:"POST",cache:!1,timeout:9e5,success:function(e){if($('[name="btn-upload-video"]').attr("disabled",!1).text(__("사진 업로드")),e&&e.success)confirm(__("등록했습니다.")+" "+__("사진 목록으로 이동하시겠습니까?"))?window.location.href.indexOf("user-main.php")>-1?(closeModal(),window.location.reload()):window.location.href="/user-main.php?userno="+Model.user_info.userno+"#recent":(closeModal(),window.location.reload());else{let t=e.error&&e.error.message?e.error.message:"";alert(__("등록하지 못했습니다.")+" "+t)}},fail:function(){alert(__("등록하지 못했습니다."))}})})},fn_video_link=function(){check_login(),$(".modal").on("click",'[name="btn-preivew"]',function(){let e=$.trim($("#htmlcode").val()),t="";e.indexOf("https://youtu.be/"),e.indexOf("https://m.youtube.com/watch?v="),e.indexOf("https://tv.naver.com/"),e.indexOf("https://tv.kakao.com/channel/"),e.indexOf("ttps://www.dailymotion.com");t=get_video_url(e),t?($("#video_url").val(t),e=t?'<iframe class="" frameborder="0" name="movie" scrolling="no" src="'+t+'" width="100%" height="auto" allow="accelerometer; encrypted-media; gyroscope; picture-in-picture; fullscreen" allowfullscreen="" style="height: 100%;"></iframe>':""):e='<p class="center">'+__("올바른 동영상 HTML을 입력해주세요")+"</p>",$("#preview-area").html(e)}).on("click",".video-thumb",function(){$($(this).attr("data-target")).click()}).on("click","[name=btn-past]",function(e){}).on("change","input[name^=pre_img]",function(){view_image(this,$($(this).attr("data-target")),"arasajin")?$(this).siblings(".btn-delete").show():$(this).siblings(".btn-delete").hide()}).on("click",".btn-delete",function(){$(this).siblings(".video-thumb").css("background",""),$(this).siblings("input").val(""),$(this).hide()}).on("keyup blur","#htmlcode",function(){let e=get_video_url($(this).val()),t=get_video_img(e);for(i in t){let e=t[i];if(e){$('[name="pre_img1_url"]').val(e).trigger("change");break}}});let e="";return $(".modal").on("change keyup","#youtube_url",function(){let t=$(this).val().trim();if(t==e)return;e=t;$(".modal [name=video_idx]").val();t?$.post("/api/v1.0/getSiteInfo/youtube.php",{url:t},function(e){e&&e.payload&&(e.payload.title&&$("#title").val(e.payload.title),$("#video_url").val(e.payload.video_url),e.payload.description&&$("#description").val(e.payload.description),e.payload.keywords&&($("#cate_idx option").each(function(){const t=$(this).val(),n=$(this).text(),a=n.indexOf("("),o=n.indexOf(")"),i=n.substr(0,a),r=n.substr(a+1,o-a-1);(e.payload.keywords.match(new RegExp(i,"i"))||e.payload.keywords.match(new RegExp(r,"i")))&&$("#cate_idx").val(t)}),$("#description").val(htmlspecialchars_decode(e.payload.description,"ENT_QUOTES"))),e.payload.image&&$("#pre_img1_url").val(e.payload.image))}):($("#title").val(""),$("#description").val(""),$("#cate_idx").val(""),$("#pre_img1_url").val(""))}),$("#cate_idx").on("change",function(){let e=$(this).val();add_request_item("getVideo/cate_list.php",{parent_idx:e},function(e){if(e&&e.success&&e.payload){let t=e.payload,n=['<option value="" readonly>부매뉴를 선택해주세요.</option>'],a=['<option value="" readonly>부매뉴가 없습니다.</option>'];if(t&&t.length>0)for(i in t)n.push('<option value="'+t[i].idx+'">'+t[i].cate_name+"</option>");else n=a;$("#cate_idx_2").find("option").remove(),$("#cate_idx_2").append(n.join(""))}})}),$('[name="preview-img"]').on("click",function(){$("#sales_banner_url_new").trigger("click")}),$("#sales_banner_url_new").on("change",function(){view_image(this,$('[name="preview-img"]'),"stube"),$('[name="preview-img"]').show(),$("#sales_banner_url").val("")}),$("#sales_banner_url").on("change",function(){view_image(this,$('[name="preview-img"]'),"stube"),$('[name="preview-img"]').show(),$("#sales_banner_url_new").get(0).value=""}),$(".modal").on("click",'[name="btn-save-video"]',function(){let e=$("#video_url").val(),t=($("#video_idx").val(),$("#htmlcode").val()),n=$("#title").val(),a=($("#description").val(),$("#cate_idx").val()),o=$("#sales_url").val(),i=$("#image1").val(),r=$("#image2").val(),s=$("#image3").val(),l=$("#image4").val(),c=$("#pre_img1_url").val(),m=$("#pre_img2_url").val(),d=$("#pre_img3_url").val(),_=$("#pre_img4_url").val();if(e=e||get_video_url(t),!e)return alert(__("올바른 동영상주소를 입력해주세요.")),!1;if($("#video_url").val(e),!n)return alert(__("동영상 제목을 입력해주세요.")),!1;if(!a)return alert(__("동영상 종류를 선택해주세요.")),!1;if(!(i||r||s||l||c||m||d||_))return alert(__("미리보기 이미지를 선택해주세요.")),!1;if(o){let e=$("#sales_banner_url_new");if(""!=$.trim(e.val())){if(tmp_url=upload_file(e,"상품 배너"),!tmp_url)return alert(__("상품 배너를 업로드하지 못했습니다.")),!1;$("[name=sales_banner_url]").val(tmp_url)}else if(""==$.trim($("#sales_banner_url").val()))return alert(__("상품 배너를 선택해주세요.")),!1}var u=$('[name="form-video-link"]');u.attr("enctype","multipart/form-data");var p=new FormData(u[0]);p.append("token",getCookie("token")),$.ajax({url:API_URL+"/putMyInfo/video_upload.php",processData:!1,contentType:!1,data:p,type:"POST",success:function(e){if(e&&e.success)confirm(__("등록했습니다.")+" "+__("동영상 목록으로 이동하시겠습니까?"))?window.location.href.indexOf("cate.php")>-1?(closeModal(),window.location.reload()):window.location.href="/cate.php?cate_idx="+a:(closeModal(),window.location.reload());else{let t=e.error&&e.error.message?e.error.message:"";alert(__("등록하지 못했습니다.")+t)}},fail:function(){alert(__("등록하지 못했습니다."))}})}),!1},fn_video_upload=function(){check_login(),$("#video_file").on("change",function(e){view_video(this,$($(this).attr("data-target"))),view_video_thumnail(e,function(){$("#thumb1").siblings(".btn-delete").show()})}),$(".modal").on("click",".video-thumb",function(){$($(this).attr("data-target")).click()}),$(".modal").on("change","input[name^=pre_img]",function(){view_image(this,$($(this).attr("data-target")),"aratube")&&$(this).siblings(".btn-delete").show()}),$(".modal").on("click",".btn-delete",function(){$(this).siblings(".video-thumb").css("background",""),$(this).siblings("input").val(""),$(this).hide()}),$(".modal").on("click",'[name="btn-upload-video"]',function(){let e=$("#video_file").val(),t=$("#video_idx").val(),n=($("#htmlcode").val(),$("#title").val()),a=$("#cate_idx").val();$("#image1").val(),$("#image2").val(),$("#image3").val(),$("#image4").val(),$("#image1_url").val(),$("#image2_url").val(),$("#image3_url").val(),$("#image4_url").val();if(!t&&!e)return alert(__("동영상 파일을 선택해주세요.")),!1;if(!n)return alert(__("동영상 제목을 선택해주세요.")),!1;if(!a)return alert(__("동영상 종류를 선택해주세요.")),!1;var o=$('[name="form-video-upload"]');o.attr("enctype","multipart/form-data");var i=new FormData(o[0]);i.append("token",getCookie("token")),$('[name="btn-upload-video"]').attr("disabled",!0).text(__("업로드중입니다.")),$.ajax({url:API_URL+"/putMyInfo/video_upload.php",processData:!1,contentType:!1,data:i,type:"POST",cache:!1,timeout:9e5,success:function(e){if($('[name="btn-upload-video"]').attr("disabled",!1).text(__("동영상 업로드")),e&&e.success)confirm(__("등록했습니다.")+" "+__("동영상 목록으로 이동하시겠습니까?"))?window.location.href.indexOf("user-main.php")>-1?(closeModal(),window.location.reload()):window.location.href="/user-main.php?userno="+Model.user_info.userno+"#recent":(closeModal(),window.location.reload());else{let t=e.error&&e.error.message?e.error.message:"";alert(__("등록하지 못했습니다.")+" "+t)}},fail:function(){alert(__("등록하지 못했습니다."))}})})},fn_video_delete=function(){check_login(),$(".modal").on("submit",'[name="form-video-delete"]',function(){let e=$("[name=video_idx]").val();if(!e)return alert(__("동영상 정보가 없습니다.")),!1;let t=$(".modal [name=cate_idx]").val(),n=$(".modal [name=ch_confirm_delete]");return n.length>0&&!n.is(":checked")?(alert(__('"복구할 수 없게 완전히 삭제함"에 체크 해주세요.')),!1):($('[name="btn-save-video"]').attr("disabled",!0).text(__("삭제중입니다.")),$.post(API_URL+"/putMyInfo/video_delete.php",{video_idx:e,token:getCookie("token")},function(e){if($('[name="btn-save-video"]').attr("disabled",!0).text(__("공유영상으로 게시")),e&&e.success)confirm(__("삭제했습니다.")+" "+__("목록으로 이동하시겠습니까?"))?window.location.href.indexOf("cate.php?cate_idx="+t)>-1?(closeModal(),window.location.reload()):window.location.href="cate.php?cate_idx="+t:(closeModal(),window.location.reload());else{let t=e.error&&e.error.message?e.error.message:"";alert(__("삭제하지 못했습니다.")+" "+t)}}),!1)})},fn_chat_banishment=function(){$("#chat_banishment").on("click",'[name="btn-banishment"]',function(){let e=$(this).attr("data-creator_userno"),t=$(this).attr("data-target_idx"),n=$(this).attr("data-ban_userno"),a=$(this).hasClass("red")?"del":"add",o=("add"==a?(__("선택한 회원을 채팅창에서 강제 퇴장시키시겠습니까?"),__("강제 퇴장된 회원은 모든 메시지가 자동 삭제되며 다시 입장이 불가합니다.")):(__("선택한 회원을 다시 입장시키시겠습니까?"),__("삭제된 메시지는 복구되지 않습니다.")),this),i=confirm();return i&&$.post(API_URL+"/putBanInfo/",{token:getCookie("token"),target_idx:t,creator_userno:e,ban_userno:n,action:a},function(e){e&&e.success?"add"==a?(alert("강제퇴장 처리했습니다."),$(o).addClass("red")):(alert("강제퇴장을 해지했습니다."),$(o).removeClass("red")):alert("강제퇴장을 처리하지 못했습니다. "+(e.error&&e.error.message?e.error.message:""))}),!1})},fn_fan_permission=function(){$("#fan_permission").on("click",'[name="btn-addmanager"]',function(){let e=$(this).attr("data-creator_userno"),t=$(this).hasClass("red")?"N":"Y",n=this;return $.post(API_URL+"/putFanInfo/",{token:getCookie("token"),creator_userno:e,fan_userno:fan_userno,bool_manager:t},function(e){e&&e.success?"Y"==t?(alert("매니저로 등록했습니다."),$(n).addClass("red")):(alert("매니저권한을 해제했습니다."),$(n).removeClass("red")):alert("매니저권한을 변경하지 못했습니다. "+(e.error&&e.error.message?e.error.message:""))}),!1})},fn_join_fan=function(){$('[name="btn-joinfan"]').on("click",function(){let e=$('#box-joinfan [name="fan_level"]').val(),t=$('#box-joinfan [name="creator_userno"]').val();return $.post(API_URL+"/putJoinFan/",{token:getCookie("token"),creator_userno:t,fan_level:e},function(e){e&&e.success?(alert("팬으로 가입했습니다."),window.location.reload()):alert("팬으로 가입하지 못했습니다. "+(e.error&&e.error.message?e.error.message:""))}),!1})},fn_warrant=function(){return $(".inList input.baseline").on("blur",function(){let e=$(this).val().toNumber();$(this).val(real_number_format(e))}),$('[name="btn-save-warrant"]').on("click",function(){let e=$("[name=b1]").val().toNumber(),t=$("[name=b2]").val().toNumber(),n=$("[name=b3]").val().toNumber(),a=$("[name=b4]").val().toNumber(),o=$("[name=b5]").val().toNumber(),i=$("[name=b6]").val().toNumber(),r=($("[name=r1_1]").is(":checked")?"Y":"N")+","+($("[name=r1_2]").is(":checked")?"Y":"N")+","+($("[name=r1_3]").is(":checked")?"Y":"N")+","+($("[name=r1_4]").is(":checked")?"Y":"N")+","+($("[name=r1_5]").is(":checked")?"Y":"N")+","+$("[name=r1_6]").val(),s=($("[name=r2_1]").is(":checked")?"Y":"N")+","+($("[name=r2_2]").is(":checked")?"Y":"N")+","+($("[name=r2_3]").is(":checked")?"Y":"N")+","+($("[name=r2_4]").is(":checked")?"Y":"N")+","+($("[name=r2_5]").is(":checked")?"Y":"N")+","+$("[name=r2_6]").val(),l=($("[name=r3_1]").is(":checked")?"Y":"N")+","+($("[name=r3_2]").is(":checked")?"Y":"N")+","+($("[name=r3_3]").is(":checked")?"Y":"N")+","+($("[name=r3_4]").is(":checked")?"Y":"N")+","+($("[name=r3_5]").is(":checked")?"Y":"N")+","+$("[name=r3_6]").val(),c=($("[name=r4_1]").is(":checked")?"Y":"N")+","+($("[name=r4_2]").is(":checked")?"Y":"N")+","+($("[name=r4_3]").is(":checked")?"Y":"N")+","+($("[name=r4_4]").is(":checked")?"Y":"N")+","+($("[name=r4_5]").is(":checked")?"Y":"N")+","+$("[name=r4_6]").val(),m=($("[name=r5_1]").is(":checked")?"Y":"N")+","+($("[name=r5_2]").is(":checked")?"Y":"N")+","+($("[name=r5_3]").is(":checked")?"Y":"N")+","+($("[name=r5_4]").is(":checked")?"Y":"N")+","+($("[name=r5_5]").is(":checked")?"Y":"N")+","+$("[name=r5_6]").val(),d=($("[name=r6_1]").is(":checked")?"Y":"N")+","+($("[name=r6_2]").is(":checked")?"Y":"N")+","+($("[name=r6_3]").is(":checked")?"Y":"N")+","+($("[name=r6_4]").is(":checked")?"Y":"N")+","+($("[name=r6_5]").is(":checked")?"Y":"N")+","+$("[name=r6_6]").val(),_=($("[name=r7_1]").is(":checked")?"Y":"N")+","+($("[name=r7_2]").is(":checked")?"Y":"N")+","+($("[name=r7_3]").is(":checked")?"Y":"N")+","+($("[name=r7_4]").is(":checked")?"Y":"N")+","+($("[name=r7_5]").is(":checked")?"Y":"N")+","+$("[name=r7_6]").val();$.post(API_URL+"/putWarrantRule/",{token:getCookie("token"),video_idx:getURLParameter("video_idx"),r1:r,r2:s,r3:l,r4:c,r5:m,r6:d,r7:_,b1:e,b2:t,b3:n,b4:a,b5:o,b6:i},function(e){e&&e.success?(alert("저장했습니다."),window.location.reload()):alert("저장하지 못했습니다. "+(e.error&&e.error.message?e.error.message:""))})}),!1},init_cam=function(){function e(e,t){const n=document.createElement("video");n.srcObject=e,n.setAttribute("playsinline","true"),n.setAttribute("autoplay","true"),n.setAttribute("muted","true");let a=k(t),o=$("#"+a).length>0?$("#"+a).empty():w.clone();o.find("video").remove(),o.attr("id",a),o.find(".btn-mic").addClass("off").removeClass("on"),o.find(".btn-video").addClass("on").removeClass("off"),o.find(".centered").append(n),u.insertBefore(o.get(0),u.firstChild)}function t(e){g=!1,_=null,l.trigger(m,"화상채팅에 참여하지 못했습니다. "+e)}function n(e){if(localStream=e,p){f&&f&&socket.emit("join",f),g=!1,_ instanceof HTMLVideoElement&&(localStream.getAudioTracks()[0].enabled=!1,!_.srcObject&&(_.srcObject=localStream));let e=$(".cam .user");e.find(".btn-mic").addClass("off").removeClass("on"),e.find(".btn-video").addClass("on").removeClass("off"),e.slideDown(),socket.emit("ready"),socket.id&&(window.localSocketID=socket.id)}else _=null;l.trigger(c)}function a(){_ instanceof HTMLVideoElement&&p?(g=!0,navigator.mediaDevices?navigator.mediaDevices.getUserMedia(b).then(n).catch(t):t("카메라가 작동하지 않습니다.")):t("카메라가 작동하지 않습니다.")}function o(e,t){let n=$("#"+k(e)).closest(".user");"on"==t?n.find(".btn-mic").addClass("on").removeClass("off"):n.find(".btn-mic").addClass("off").removeClass("on")}function i(e,t){let n=$("#"+k(e)).closest(".user");"on"==t?n.find(".btn-video").addClass("on").removeClass("off"):n.find(".btn-video").addClass("off").removeClass("on")}function s(e){peerConnections[e]&&peerConnections[e].close(),delete peerConnections[e];let t=document.querySelector("#"+k(e));t&&t.remove()}if($(".cam .user").is(":visible"))return void $(".cam .btn-close-cam").trigger("click");const l=$(".cam"),c=$.Event("start_success"),m=$.Event("start_fail"),d=$.Event("end");window.socket=io.connect("https://video-chat.stube.co.kr:3334/"),window.localSocketID="";let _=document.querySelector(".localVideo");const u=document.querySelector(".remoteVideos");window.peerConnections=window.peerConnections?window.peerConnections:{};let p=!0;const f=sha1(window.location.host+"/room/"+getURLParameter("video_idx"));let g=!1,h=0;window.localStream=null;const v={iceServers:[{urls:["stun:stun.l.google.com:19302"]}]},b={audio:!0,video:{facingMode:"user",frameRate:{min:10,ideal:15,max:60},width:{ideal:512,max:1024},height:{ideal:288,max:576}}};socket.on("full",function(e){l.trigger(m,"화상채팅방에 자리가 없습니다.")}),socket.on("bye",function(e){s(e)}),socket.on("init",function(e){h=1*e,socket.id&&(window.localSocketID=socket.id)}),window.onunload=window.onbeforeunload=function(){socket.close()},socket.on("ready",function(t){if(!(_ instanceof HTMLVideoElement&&_.srcObject))return;const n=new RTCPeerConnection(v);peerConnections[t]=n,_ instanceof HTMLVideoElement&&p&&n.addStream(_.srcObject),n.createOffer().then(e=>n.setLocalDescription(e)).then(function(){socket.emit("offer",t,n.localDescription)}),n.onaddstream=(n=>e(n.stream,t)),n.onicecandidate=function(e){e.candidate&&socket.emit("candidate",t,e.candidate)}}),socket.on("offer",function(t,n){const a=new RTCPeerConnection(v);peerConnections[t]=a,_ instanceof HTMLVideoElement&&p&&a.addStream(_.srcObject),a.setRemoteDescription(n).then(()=>a.createAnswer()).then(e=>a.setLocalDescription(e)).then(function(){socket.emit("answer",t,a.localDescription)}),a.onaddstream=(n=>e(n.stream,t)),a.onicecandidate=function(e){e.candidate&&socket.emit("candidate",t,e.candidate)}}),socket.on("candidate",function(e,t){peerConnections[e].addIceCandidate(new RTCIceCandidate(t)).catch(e=>void 0)}),socket.on("answer",function(e,t){peerConnections[e].setRemoteDescription(t)}),socket.on("broadcast",function(e,t,n){switch(t){case"mic":o(e,n);break;case"video":i(e,n);break;case"disconnect":s(e)}});const k=function(e){return e.replace(/[^a-zA-Z]+/g,"").toLowerCase()},w=$('<div class="user remote"><div class="btn btn-mic off"><i class="fas fa-microphone-alt-slash off"></i><i class="fas fa-microphone-alt on"></i></div><div class="btn btn-video on"><i class="fas fa-video-slash off"></i></div><div class="centered"></div></div>');a(),l.attr("data-init")||l.on("click",".btn-close-cam",function(){localStream.getTracks().forEach(function(e){e.stop()}),_.srcObject=null;for(let e in peerConnections)s(e);peerConnections[window.localSocketID]&&peerConnections[window.localSocketID].close(),socket.emit("broadcast","disconnect",window.localSocketID),r=socket.disconnect(),r=socket.close(),socket=null,$(_).closest(".user").slideUp(),l.find(".user.remote").remove(),l.trigger(d)}).on("click",".btn-mic",function(){$(this).hasClass("on");$(this).hasClass("on")?(localStream.getAudioTracks()[0].enabled=!1,socket.emit("broadcast","mic","off"),$(this).addClass("off").removeClass("on")):(localStream.getAudioTracks()[0].enabled=!0,socket.emit("broadcast","mic","on"),$(this).addClass("on").removeClass("off"))}).on("click",".btn-video",function(){$(this).hasClass("on");$(this).hasClass("on")?(localStream.getVideoTracks()[0].enabled=!1,socket.emit("broadcast","video","off"),$(this).addClass("off").removeClass("on")):(localStream.getVideoTracks()[0].enabled=!0,socket.emit("broadcast","video","on"),$(this).addClass("on").removeClass("off"))}).attr("data-init",!0)},fn_views=function(){$(".cam").on("click",".btn-open-cam",function(){init_cam()}).on("start_fail",function(e,t){alert(t)}).on("start_success",function(){$(".cam .cam-off").hide(),$(".cam .cam-on").show()}).on("end",function(e){$(".cam .cam-off").show(),$(".cam .cam-on").hide()});let e=function(){$(".cam .user video").each(function(){$(this).width()<$(this).height()?$(this).addClass("vertical"):$(this).removeClass("vertical")}),setTimeout(function(){e()},1e3)};setTimeout(function(){e()},1e3),$(".mobile_cheat_box").append($(".chat_box").clone()),set_position_chatbox(),$(window).on("resize",set_position_chatbox),$(".setting").on("click",function(){$(".setting_list").toggleClass("active")}),set_scroll_bottom(),get_new_message(5e3),$(".comment-wrap").on("scroll",function(){$(this).scrollTop()<50&&!scroll_searching&&get_old_message()}).on("click",".btn-delete-msg",function(){let e={token:getCookie("token")},t=$(this).closest('[name="msg_box"]');e.idx=$(this).attr("data-idx"),confirm(__("삭제된 메시지는 복구되지 않습니다.")+" \n"+__("삭제하시겠습니까?"))&&$.post(API_URL+"/putChatMessage/delete.php",e,function(e){if(e&&e.success)t.remove();else{let t=e.error&&e.error.message?e.error.message:"";alert(__("메시지를 삭제하지 못했습니다.")+" "+t)}})}),$('[name="btn-del_chat"]').on("click",function(){let e={token:getCookie("token"),target_idx:getURLParameter("video_idx")};confirm(__("삭제된 메시지는 복구되지 않습니다.")+" \n"+__("전체 메시지를 삭제하시겠습니까?"))&&$.post(API_URL+"/putChatMessage/delall.php",e,function(e){if(e&&e.success)$('[name=comment-list] [name="msg_box"]').remove(),alert(__("메시지를 삭제했습니다.")),$(".setting_list").toggleClass("active");else{let t=e.error&&e.error.message?e.error.message:"";alert(__("메시지를 삭제하지 못했습니다.")+" "+t)}})});let t={symbol:"SPAY",amount:0,coin_name:""};const n=function(e){let n={token:getCookie("token")};n.video_idx=window.chat_target_idx,n.target_idx=window.chat_target_idx,n.symbol=t.symbol,n.point_amount=t.amount,n.message=e||$("[name=message]:visible").val(),t.amount>0?$.post(API_URL+"/putMyInfo/send_point.php",n,function(e){if(e&&e.success)$.post(API_URL+"/putChatMessage/",n,function(e){if(e&&e.success)$("[name=message]:visible").val(""),t={symbol:"",amount:0},get_new_message();else{let t=e.error&&e.error.message?e.error.message:"";alert(__("메시지를 보내지 못했습니다.")+" "+t)}}),$(".support-coins .btn-coins").attr("disabled",!0).attr("title",__("이미 사용하셨습니다.")),$("[name=btn-close-popup]").click();else{let t=e.error&&e.error.message?e.error.message:"";alert(__("포인트를 보내지 못했습니다.")+" "+t)}}):$.post(API_URL+"/putChatMessage/",n,function(e){if(e&&e.success)$("[name=message]:visible").val(""),t={symbol:"",amount:0},get_new_message();else{let t=e.error&&e.error.message?e.error.message:"";alert(__("메시지를 보내지 못했습니다.")+" "+t)}})};$('[name="message"]').on("keyup keypress",function(){let e=$(this).val().substr(0,300);$("#msg_cnt").text(number_format(e.length)),$(this).val(e)}).on("keydown",function(e){$(this).val(),$("#msg_max").text();let t=get_keycode(e);if(13==t)return $("[name=btn-write-message]:visible").click(),!1}),$("[name=btn-write-message]").on("click",function(){let e=$('[name="message"]:visible').val();if(!$.trim(e)&&t.amount<1)return alert(__("메시지를 작성해주세요.")),!1;n(e)}),$("[name=btn-close-popup]").on("click",function(){$(".support-popup").addClass("hide"),$("[name=message]:visible").css("padding-top","10px"),t={symbol:"",amount:0,coin_name:""}}),$(".support-coins .btn-coins").on("click",function(){let e=$(this).val(),n=$(this).attr("data-symbol");t.symbol=n,t.coin_name=Model.currency[n]?Model.currency[n].name:n,t.amount=e,t.amount_str=number_format(e),$("[name=send_coin_icon]").removeClass(function(e,t){return(t.match(/(^|\s)coin-\S+/g)||[]).join(" ")}).addClass(get_coin_icon_class(e)),force_rander("send_coin_info",t),$(".form-area .support-popup").removeClass("hide"),$("[name=message]:visible").css("padding-top",$(".support-message").height()+8)}),$(".support-coins ul.content-pd1 li").on("click",function(){$(this).addClass("active").siblings("li").removeClass("active")}),$(".photo-area .photo:gt(0)").on("click",function(){let e=$(this).attr("data-src");$(".photo-area .photo.main img").attr("src",e)}),$(".sales a").on("click",function(){let e=(this.href+"").indexOf("?")<0?this.href+"?t="+time():this.href+"&t="+time();if((e.indexOf("shop.app.stube.co.kr")>-1||e.indexOf("shop.stube.co.kr")>-1)&&$.ajax({url:e,method:"post",async:!1,cache:!1,data:{token:getCookie("token")}},function(){}),$(window).width()<=450){let t=$("#window_sales");return t.find("iframe").attr("src",e),t.slideToggle(),!1}}),$('#window_sales [name="btn_close_sales"]').on("click",function(){$("#window_sales").slideToggle()}),$(".sales a").each(function(){(this.href+"").indexOf("?"),this.href,time()})},fn_user_main=function(){$(".mobile_cheat_box").append($(".chat_box").clone()),set_position_chatbox(),$(window).on("resize",set_position_chatbox),$(".setting").on("click",function(){$(".setting_list").toggleClass("active")}),set_scroll_bottom(),get_new_message(5e3),$(".comment-wrap").on("scroll",function(){$(this).scrollTop()<50&&!scroll_searching&&get_old_message()}).on("click",".btn-delete-msg",function(){let e={token:getCookie("token")},t=$(this).closest('[name="msg_box"]');e.idx=$(this).attr("data-idx"),confirm(__("삭제하시겠습니까?"))&&$.post(API_URL+"/putChatMessage/delete.php",e,function(e){if(e&&e.success)t.remove();else{let t=e.error&&e.error.message?e.error.message:"";alert(__("메시지를 삭제하지 못했습니다.")+" "+t)}})}),$('[name="btn-del_chat"]').on("click",function(){let e={token:getCookie("token"),target_idx:getURLParameter("userno")};confirm(__("삭제된 메시지는 복구되지 않습니다.")+" \n"+__("전체 메시지를 삭제하시겠습니까?"))&&$.post(API_URL+"/putChatMessage/delall.php",e,function(e){if(e&&e.success)$('[name=comment-list] [name="msg_box"]').remove(),alert(__("메시지를 삭제했습니다.")),$(".setting_list").toggleClass("active");else{let t=e.error&&e.error.message?e.error.message:"";alert(__("메시지를 삭제하지 못했습니다.")+" "+t)}})});let e={symbol:"",amount:0,coin_name:""};const t=function(t){let n={token:getCookie("token")};n.userno=window.chat_target_idx,n.target_idx=window.chat_target_idx,n.symbol=e.symbol,n.point_amount=e.amount,n.message=t||$("[name=message]:visible").val(),e.amount>0?$.post(API_URL+"/putMyInfo/send_point.php",n,function(t){if(t&&t.success)$.post(API_URL+"/putChatMessage/",n,function(t){if(t&&t.success)$("[name=message]:visible").val(""),e={symbol:"",amount:0},get_new_message();else{let e=t.error&&t.error.message?t.error.message:"";alert(__("메시지를 보내지 못했습니다.")+" "+e)}}),$(".support-coins .btn-coins").attr("disabled",!0).attr("title",__("이미 사용하셨습니다.")),$("[name=btn-close-popup]").click();else{
let e=t.error&&t.error.message?t.error.message:"";alert(__("포인트를 보내지 못했습니다.")+" "+e)}}):$.post(API_URL+"/putChatMessage/",n,function(t){if(t&&t.success)$("[name=message]:visible").val(""),e={symbol:"",amount:0},get_new_message();else{let e=t.error&&t.error.message?t.error.message:"";alert(__("메시지를 보내지 못했습니다.")+" "+e)}})};$('[name="message"]').on("keyup keypress",function(){let e=$(this).val().substr(0,300);$("#msg_cnt").text(number_format(e.length)),$(this).val(e)}).on("keydown",function(e){$(this).val(),$("#msg_max").text();let t=get_keycode(e);if(13==t)return $("[name=btn-write-message]:visible").click(),!1}),$("[name=btn-write-message]").on("click",function(){let n=$('[name="message"]:visible').val();if(!$.trim(n)&&e.amount<1)return alert(__("메시지를 작성해주세요.")),!1;t(n)}),$("[name=btn-close-popup]").on("click",function(){$(".support-popup").addClass("hide"),$("[name=message]:visible").css("padding-top","10px"),e={symbol:"",amount:0,coin_name:""}}),$(".support-coins .btn-coins").on("click",function(){let t=$(this).val(),n=$(this).attr("data-symbol");e.symbol=n,e.coin_name=Model.currency[n]?Model.currency[n].name:n,e.amount=t,e.amount_str=number_format(t),$("[name=send_coin_icon]").removeClass(function(e,t){return(t.match(/(^|\s)coin-\S+/g)||[]).join(" ")}).addClass(get_coin_icon_class(t)),force_rander("send_coin_info",e),$(".form-area .support-popup").removeClass("hide"),$("[name=message]:visible").css("padding-top",$(".support-message").height()+8)}),$(".support-coins ul.content-pd1 li").on("click",function(){$(this).addClass("active").siblings("li").removeClass("active")}),$(".photo-area .photo:gt(0)").on("click",function(){let e=$(this).attr("data-src");$(".photo-area .photo.main img").attr("src",e)});let n=1;const a=getURLParameter("cate_idx"),o=getURLParameter("userno"),i=getURLParameter("sort");a&&$(document).on("scroll",function(){let e=$(".item-grid li:eq(0)").height();$(this).scrollTop()+$(window).innerHeight()+4*e>=$("body").height()&&!scroll_searching&&!scroll_end&&(scroll_searching=!0,get_video("full"==a?"":a,o,"",++n,i,gen_video_htmnl))})},fn_user_info=function(){Model.check_pin<time()-600?window.location.href="/check-pin.php":Model.check_pin=0,$("#user_info form").each(function(){$(this).reset&&$(this).reset()}),$("#user_info input[type=password]").on("keypress",function(e){let t=get_keycode(e),n=get_str_by_keycode(t);if("8"==t||"46"==t||"9"==t||"13"==t||"16"==t||"17"==t||"18"==t||"19"==t||"20"==t)"8"!=t&&"46"!=t||$(this).prev("input[type=password]").select(),$(this).val("");else{if(n.match(/[^0-9]/))return!1;$(this).val(n),$(this).next("input[type=password]").select(),$("#user_info [name=userpw]").val($("#user_info [name=userpw1]").val()+""+$("#user_info [name=userpw2]").val()+$("#user_info [name=userpw3]").val()+$("#user_info [name=userpw4]").val()+$("#user_info [name=userpw5]").val()+$("#user_info [name=userpw6]").val())}return!1}).on("keydown",function(e){let t=get_keycode(e);if("8"==t)return $(this).prev("input[type=password]").select(),$(this).val(""),$("#user_info [name=userpw]").val($("#user_info [name=userpw1]").val()+""+$("#user_info [name=userpw2]").val()+$("#user_info [name=userpw3]").val()+$("#user_info [name=userpw4]").val()+$("#user_info [name=userpw5]").val()+$("#user_info [name=userpw6]").val()),!1;13==t&&$(".btn_group .btn:eq(0)").trigger("click")}).on("click",function(){$(this).select()});const e=function(e){$("#user_info .error_txt").text(e)};$("#user_info [name=btn-check-pin]").on("click",function(){let t=$("#user_info [name=userpw]"),n=t.val();return n?($("#user_info [name=userpw]").val(n),e(""),add_request_item("checkPin",{pin:n},function(t){t&&t.success&&t.payload?($("#check_pin").hide(),$("#edit_info").show()):e(__("핀번호가 일치하지 않습니다!"))}),!1):(e(__("핀번호를 입력해주세요.")),t.focus(),!1)});let t=0,n=!1,a=!1,o="",r="";$("[name=btn-request]").on("click",function(){if(n)return alert(__("인증번호를 보내는중입니다.")+__("잠시만 기다려주세요.")),!1;let e=($("[name=mobile_number]").val()+"").trim(),a="82",i="KR";if(!e)return alert(__("핸드폰 번호를 입력해주세요")),!1;e=a+e.replace(/^0/,""),e=e.replace(/[^0-9]/g,""),$("[name=mobile_number]").attr("disabled",!0),o=e,confirmed_mobile_calling_code=a,r=i,n=!0,window.send_authmsg(e,function(e){if(n=!1,e&&e.success)t=Math.floor((new Date).getTime()/1e3)+3600,display_remain_time(t,"#form_phone [name=min]","#form_phone [name=sec]"),$("#form_phone [name=min]").parent().removeClass("hide"),$("[name=btn-confirm]").show(),$("[name=confirm_number]").show().focus(),alert(__("인증번호를 발송했습니다."));else{let t=e.error&&e.error.message?e.error.message:"";alert(__("인증메시지를 보내지 못했습니다.")+" "+t),$("#form_phone [name=min]").parent().addClass("hide"),$("[name=mobile_number1],[name=mobile_number2],[name=mobile_number3]").attr("disabled",!1)}})}),$("[name=btn-confirm]").on("click",function(){let e=$("[name=confirm_number]").val();return 0==t?(alert(__("인증 요청을 해주세요.")),!1):t-Math.floor((new Date).getTime()/1e3)<=0?($("[name=mobile_number1],[name=mobile_number2],[name=mobile_number3]").attr("disabled",!1),alert(__("유효시간이 지났습니다. 다시 인증 요청을 해주세요.")),!1):e?void window.check_authcode(e,function(e){if(e&&e.success)a=!0,$("[name=confirm_number]").attr("disabled",!0),alert(__("휴대폰번호가 인증되었습니다."));else{$("[name=confirm_number]").attr("disabled",!1);let t=e.error&&e.error.message?e.error.message:"";alert(__("올바른 인증번호를 입력해주세요.")+" "+t)}}):(alert(__("인증번호를 입력해주세요.")),!1)}),$('[name="preview-profile_img"]').on("click",function(){$("#preview_img").trigger("click")}),$("#preview_img").on("change",function(){view_image(this,$('[name="preview-profile_img"]'),"stube")}),$('[name="btn-save_info"]').on("click",function(){if(""!=$.trim($("#preview_img").val())){$form=$('[name="form-profile_img"]'),$form.attr("enctype","multipart/form-data");var e=new FormData($form[0]);if(e.append("token",getCookie("token")),$.ajax({url:API_URL+"/upload/?",async:!1,processData:!1,contentType:!1,data:e,type:"POST",success:function(e){if(e&&e.success&&e.payload){let t=e.payload[0];t.url?($("[name=profile_img]").val(t.url),readURL(self)):alert(__("파일을 저장하지 못했습니다."))}else{let t=e.error&&e.error.message?e.error.message:"";alert(__("파일을 저장하지 못했습니다.")+" "+t)}},fail:function(){alert(__("파일을 업로드하지 못했습니다."))}}),!$("[name=profile_img]").val())return}save_my_info(function(e){if(e&&e.payload)alert(__("저장했습니다."));else{let t=e.error&&e.error.message?e.error.message:"";alert(__("저장하지 못했습니다.")+" "+t)}})}),$("[name=default_cate_idx]").on("change",function(){let e=$(this).val();add_request_item("getVideo/cate_list.php",{parent_idx:e},function(e){if(e&&e.success&&e.payload){let t=e.payload,n=['<option value="" readonly>부매뉴를 선택해주세요.</option>'],a=['<option value="" readonly>부매뉴가 없습니다.</option>'];if(t&&t.length>0)for(i in t)n.push('<option value="'+t[i].idx+'">'+t[i].cate_name+"</option>");else n=a;$("[name=second_cate_idx]").find("option").remove(),$("[name=second_cate_idx]").append(n.join(""))}})})},fn_user_edit=function(){$("#check_pin").show(),$("#edit_info").hide(),$("#user_info form").each(function(){$(this).reset&&$(this).reset()}),$("#user_info input[type=password]").on("keypress",function(e){let t=get_keycode(e),n=get_str_by_keycode(t);if("8"==t||"46"==t||"9"==t||"13"==t||"16"==t||"17"==t||"18"==t||"19"==t||"20"==t)"8"!=t&&"46"!=t||$(this).prev("input[type=password]").select(),$(this).val("");else{if(n.match(/[^0-9]/))return!1;$(this).val(n),$(this).next("input[type=password]").select(),$("#user_info [name=userpw]").val($("#user_info [name=userpw1]").val()+""+$("#user_info [name=userpw2]").val()+$("#user_info [name=userpw3]").val()+$("#user_info [name=userpw4]").val()+$("#user_info [name=userpw5]").val()+$("#user_info [name=userpw6]").val())}return!1}).on("keydown",function(e){let t=get_keycode(e);if("8"==t)return $(this).prev("input[type=password]").select(),$(this).val(""),$("#check_pin [name=userpw]").val($("#check_pin [name=userpw1]").val()+""+$("#check_pin [name=userpw2]").val()+$("#check_pin [name=userpw3]").val()+$("#check_pin [name=userpw4]").val()+$("#check_pin [name=userpw5]").val()+$("#check_pin [name=userpw6]").val()),!1;13==t&&$(".btn_group .btn:eq(0)").trigger("click")}).on("click",function(){$(this).select()});const e=function(e){$("#user_info .error_txt").text(e)};$("#user_info [name=btn-check-pin]").on("click",function(){let t=$("#user_info [name=userpw]"),n=t.val();return n?($("#user_info [name=userpw]").val(n),e(""),add_request_item("checkPin",{pin:n},function(t){t&&t.success&&t.payload?($("#check_pin").hide(),$("#edit_info").show()):e(__("핀번호가 일치하지 않습니다!"))}),!1):(e(__("핀번호를 입력해주세요.")),t.focus(),!1)});let t=0,n=!1,a=!1,o="",i="";$("[name=btn-request]").on("click",function(){if(n)return alert(__("인증번호를 보내는중입니다.")+__("잠시만 기다려주세요.")),!1;let e=($("[name=mobile_number]").val()+"").trim(),a="82",r="KR";if(!e)return alert(__("핸드폰 번호를 입력해주세요")),!1;e=a+e.replace(/^0/,""),e=e.replace(/[^0-9]/g,""),$("[name=mobile_number]").attr("disabled",!0),o=e,confirmed_mobile_calling_code=a,i=r,n=!0,window.send_authmsg(e,function(e){if(n=!1,e&&e.success)t=Math.floor((new Date).getTime()/1e3)+3600,display_remain_time(t,"#form_phone [name=min]","#form_phone [name=sec]"),$("#form_phone [name=min]").parent().removeClass("hide"),$("[name=btn-confirm]").show(),$("[name=confirm_number]").show().focus(),alert(__("인증번호를 발송했습니다."));else{let t=e.error&&e.error.message?e.error.message:"";alert(__("인증메시지를 보내지 못했습니다.")+" "+t),$("#form_phone [name=min]").parent().addClass("hide"),$("[name=mobile_number1],[name=mobile_number2],[name=mobile_number3]").attr("disabled",!1)}})}),$("[name=btn-confirm]").on("click",function(){let e=$("[name=confirm_number]").val();return 0==t?(alert(__("인증 요청을 해주세요.")),!1):t-Math.floor((new Date).getTime()/1e3)<=0?($("[name=mobile_number1],[name=mobile_number2],[name=mobile_number3]").attr("disabled",!1),alert(__("유효시간이 지났습니다. 다시 인증 요청을 해주세요.")),!1):e?void window.check_authcode(e,function(e){if(e&&e.success)a=!0,$("[name=confirm_number]").attr("disabled",!0),alert(__("휴대폰번호가 인증되었습니다."));else{$("[name=confirm_number]").attr("disabled",!1);let t=e.error&&e.error.message?e.error.message:"";alert(__("올바른 인증번호를 입력해주세요.")+" "+t)}}):(alert(__("인증번호를 입력해주세요.")),!1)})},fn_cate=function(){add_event_click_left_menu_tab();let e=1;const t=getURLParameter("cate_idx"),n=getURLParameter("userno"),a=getURLParameter("sort");$(document).on("scroll",function(){let o=$(".item-grid li:eq(0)").height();$(this).scrollTop()+$(window).innerHeight()+4*o>=$("body").height()&&!scroll_searching&&!scroll_end&&(scroll_searching=!0,get_video(t,n,"",++e,a,gen_video_htmnl))})},fn_search=function(){let e=1;const t=getURLParameter("cate_idx"),n=getURLParameter("keyword"),a=getURLParameter("userno"),o=getURLParameter("sort");$(document).on("scroll",function(){let i=$(".item-grid li:eq(0)").height();$(this).scrollTop()+$(window).innerHeight()+4*i>=$("body").height()&&!scroll_searching&&!scroll_end&&(scroll_searching=!0,get_video(t,a,n,++e,o,gen_video_htmnl))})},fn_pay=function(){$("#pay").on("click",".btn.btn-method",function(){let e=$(this).attr("data-method");switch($(".box_bank").hide(),e){case"bank":$(".box_bank").show();break;default:alert("준비중입니다.")}return!1}),$("#pay").on("click",".btn.btn-pay",function(){let e=$(this).attr("data-method"),t=$("#pay [name=goods_no]").val(),n=$("#pay [name=price]").val(),a=$("#pay [name=amount]").val(),o=$("#pay [name=sell_symbol]").val(),i=$("#pay [name=item_symbol]").val();switch(e){case"bank":fn_pay_bank(t,n,o,a,i)}return!1})},fn_pay_bank=function(e,t,n,a,o){let i=$("#pay [name=deposit_name]").val(),r=$("#pay [name=address]").val();if(!i)return alert("입금자명을 입력해주세요."),void $("#pay [name=deposit_name]").focus();$.post(API_URL+"/charge/",{goods_no:e,pay_amount:t,pay_symbol:n,charge_amount:a,charge_symbol:o,app_id:SERVICE_NAME,service_name:SERVICE_NAME,pay_method:"bank",deposit_name:i,address:r,token:getCookie("token")},function(e){if(e&&e.success)alert(__("등록 되었습니다.")+"<br> "+__("입금주소로 결제금액을 입금해주세요."));else{let t=e.error&&e.error.message?e.error.message:"";alert("계좌이체를 등록하지 못했습니다."+t)}},"json")};$('[name="btn-logout"]').on("click",function(){return fn_logout(),!1}),$('[name="btn-profile"]').on("click",function(){return $(".box_submenu").toggle(),!1});const default_profile_img="/@resource/images/common/basic_profile.png";$(document).on("error",".img_profile",function(){alert(1),$(this).attr("src",default_profile_img)});let page_controller=window.location.pathname.replace(/\/(.*).php|html/,"$1");page_controller=page_controller.replace(/-/g,"_"),page_controller=page_controller&&"/"!=page_controller?page_controller:"index",page_controller=0===page_controller.indexOf("/")?substr(page_controller,1):page_controller;try{eval("fn_"+page_controller+"()")}catch(e){}const get_user_info=function(){add_request_item("getMyInfo",{token:getCookie("token")},function(e){if(e&&e.success&&!e.error){let t=e.payload;Model.user_info=t}})};get_user_info();const get_user_wallet=function(){add_request_item("getBalance",{token:getCookie("token")},function(e){if(e&&e.success&&!e.error){let t={};for(i in e.payload){let n=e.payload[i];n.confirmed=1*n.confirmed,n.unconfirmed=1*n.unconfirmed,t[n.symbol]=n}Model.user_wallet=t}})};get_user_wallet();const get_currency=function(){add_request_item("getCurrency",{},function(e){if(e&&e.success&&!e.error){let t=Model.currency,n=Model.exchange_rate;for(i in e.payload){let a=e.payload[i];"HTC"==a.symbol&&(a.price=1e4),t[a.symbol]?(t[a.symbol].exchange_price=1*a.price,t[a.symbol].name=a.name):t[a.symbol]={exchange_price:1*a.price,is_blockchain:"Y"==a.crypto_currency,is_virtual_currency:!0,pre_symbol:"",sub_symbol:" "+a.symbol,name:" "+a.name,symbol_image:""},n[a.symbol]&&(n[a.symbol]=1*a.price)}Model.currency=t,Model.exchange_rate=n}})};get_currency(),$(".scroll-content").length>0&&$(".scroll-content").each(function(){$(this).scrollbar({ignoreMobile:!0})}),$(document).on("keyup",".onlynum",function(e){$(this).val($(this).val().replace(/[^0-9.,]/g,""))}).on("keydown",".onlynum",input_filter_number),$(document).on("keyup change",".realnumber",function(e){$(this).val(real_number_format($(this).val()))}).on("keydown",".onlynum",input_filter_number),$(document).on("keyup",".onlyeng",function(e){$(this).val($(this).val().replace(/[^\!-z]/g,""))})});